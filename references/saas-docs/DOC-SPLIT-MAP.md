# DOC-SPLIT-MAP.md - FDCドキュメント分割マップ

> **作成日**: 2025-12-02
> **最終更新**: 2025-12-02（Phase 14.7 進行中）
> **目的**: FDC-GRAND-GUIDE.md（v6.1）の分割結果を可視化

---

## 1. 分割サマリ

| 項目 | Before (v6.1) | After (v7.0) |
|------|---------------|--------------|
| FDC-GRAND-GUIDE.md サイズ | ~128KB (2,700行) | ~5KB (148行) |
| コアドキュメント | 1ファイル | 5ファイル |
| AI読み込み可否 | ❌ トークン超過 | ✅ 1回で読み込み可能 |
| 開発起点 | FDC-GRAND-GUIDE.md | FDC-CORE.md |

---

## 2. 分割マップ（視覚化）

```
【Before: FDC-GRAND-GUIDE.md (v6.1)】
┌────────────────────────────────────────────────────────┐
│ FDC-GRAND-GUIDE.md (~128KB, 2,700行)                   │
│                                                        │
│ §0  位置づけ・開発状況 ─────────────────────────────┐ │
│ §1  開発理念・AIチーム体制 ─────────────────────────┤ │
│ §2  サブエージェント運用ルール ─────────────────────┤ │
│ §3  プロジェクト基本構造 (技術スタック・ディレクトリ) ┤ │
│ §4  データベース設計 ───────────────────────────────┤ │
│ §5  セキュリティ設計 (認証・認可・暗号化) ──────────┤ │
│ §6  Workspace機能 ──────────────────────────────────┤ │
│ §7  監査ログ機能 ───────────────────────────────────┤ │
│ §8  レポート機能 ───────────────────────────────────┤ │
│ §9  フェーズロードマップ (Phase 1-8) ───────────────┤ │
│ §10 Phase 8-12 詳細 (非常に長い) ───────────────────┤ │
│ §10-A〜E Phase 9-12 マスタープラン ─────────────────┤ │
│ §11 テスト戦略 ─────────────────────────────────────┤ │
│ §12 デプロイ・運用 ─────────────────────────────────┤ │
│ §13 開発運用ガイド ─────────────────────────────────┤ │
│ §15 まとめ ─────────────────────────────────────────┤ │
│ §16 付録 ───────────────────────────────────────────┤ │
│ §17 Lessons Learned ────────────────────────────────┘ │
└────────────────────────────────────────────────────────┘

                         ↓ 分割

【After: 5ファイル構成 (v7.0)】

┌─────────────────────────────────────────────────────────┐
│ FDC-GRAND-GUIDE.md (~5KB) - インデックス               │
│ ・分割ガイド                                           │
│ ・ドキュメント構造（ツリー表示）                       │
│ ・クイックスタート                                     │
│ ・現在の開発状況（リンク）                             │
└─────────────────────────────────────────────────────────┘
                         │
    ┌────────────────────┼────────────────────┐
    ↓                    ↓                    ↓
┌─────────────┐   ┌──────────────────────────────────────┐
│ FDC-CORE.md │   │ docs/legacy/ (参照用)                │
│ (~15KB)     │   │                                      │
│ ⭐ 開発時   │   │ ├── PHASE-HISTORY.md (~35KB)        │
│ はこちら    │   │ │   §9, §10, Phase完了サマリ         │
│             │   │ │                                    │
│ ・3層アーキ │   │ ├── ARCHITECTURE-DETAIL.md (~20KB)  │
│ ・AI運用   │   │ │   §3, テスト構成                   │
│ ・技術スタ │   │ │                                    │
│ ・Phase完了│   │ ├── SECURITY-DB-DETAIL.md (~25KB)   │
│ ・ドキュメ │   │ │   §4, §5, §6, §7, §8               │
│   ントイン │   │ │                                    │
│   デックス │   │ └── OPS-LESSONS.md (~15KB)          │
│ ・開発フロー│   │     §17                              │
│ ・用語集   │   │                                      │
└─────────────┘   └──────────────────────────────────────┘
```

---

## 3. 各ファイルの内容詳細

### 3.1 FDC-CORE.md（開発コアガイド）⭐

**目的**: 開発開始時に必要な情報のみを集約

| セクション | 内容 |
|-----------|------|
| §0 位置づけ | 開発状況サマリ |
| §1 3層アーキテクチャ | OKR→ActionMap→Task |
| §2 開発理念・AIチーム | 三位一体モデル |
| §3 サブエージェント運用 | 基本原則 |
| §4 技術スタック | バージョン一覧 |
| §5 フェーズ完了状況 | 一覧表 |
| §6 ドキュメントインデックス | リンク集 |
| §7 開発フロー | 7ステップ |
| §8 本番環境 | URL・構成 |
| §9 用語集 | 略語一覧 |

### 3.2 PHASE-HISTORY.md（Phase履歴）

**目的**: 全Phaseの詳細履歴を保存

| セクション | 内容 |
|-----------|------|
| Phase完了サマリ一覧 | 全Phaseの状態・完了日 |
| Phase 10 完了サマリ | TODO機能拡張詳細 |
| Phase 11 完了サマリ | Action Map詳細 |
| Phase 12 完了サマリ | OKR詳細 |
| Phase 13 完了サマリ | AI機能詳細 |
| Phase 13.5 完了サマリ | レポートライン詳細 |
| Phase 14.x 完了サマリ | CSV・スケーラビリティ |
| Phase 9.x 完了サマリ | 基盤整備詳細 |
| Phase 7-8 | 初期セキュリティ |
| Phase 1-6 | 初期開発 |

### 3.3 ARCHITECTURE-DETAIL.md（アーキテクチャ詳細）

**目的**: ディレクトリ構造・データフロー・テスト構成の詳細

| セクション | 内容 |
|-----------|------|
| 主要依存関係 | package.json 抜粋 |
| ディレクトリ構造 | 完全なツリー |
| アーキテクチャパターン | 楽観的排他・圧縮・コード分割・ViewModel |
| データフロー | 認証フロー図 |
| 認証フロー詳細 | 7ステップ |
| テスト構成 | Playwright・Vitest |
| 環境変数 | 完全リスト |
| デプロイコマンド | Vercel・マイグレーション |

### 3.4 SECURITY-DB-DETAIL.md（セキュリティ・DB詳細）

**目的**: DB設計・認可アーキテクチャ・暗号化の詳細仕様

| セクション | 内容 |
|-----------|------|
| データベース設計 | 7テーブルのDDL |
| 認可アーキテクチャ | SERVICE_ROLE_KEY使用・アプリ層認可 |
| 認証設計 | Supabase Auth・PKCE |
| 認可（RBAC） | ロール・権限マトリクス |
| 暗号化（AES-256-GCM） | 2層構造・関数一覧 |
| セキュリティハーデニング | 実装済み対策 |
| Workspace機能 | 概念・機能 |
| 監査ログ機能 | 記録対象・API |
| レポート機能 | ロール別・エクスポート |

### 3.5 OPS-LESSONS.md（運用教訓）

**目的**: 運用教訓・Lessons Learnedの記録

| セクション | 内容 |
|-----------|------|
| Phase 9.7 からの教訓 | 技術負債ゼロ化 |
| Phase移行チェックリスト | 再発防止 |
| Phase 9.8 の教訓 | プロアクティブ基盤強化 |
| Supabase DB接続二重化 | Transaction Pooler vs Direct |
| Performance Spec v1.0 | P95目標値 |
| Phase 9-12 戦略 | 継続的パフォーマンス維持 |
| 技術負債解消状況 | 計測結果 |
| GO/NO-GO 条件 | Phase移行判断 |
| ブランチ戦略 | コミット規約 |

---

## 4. 開発時の参照フロー

```
開発開始
    │
    ▼
┌─────────────────────────────────────────────────┐
│ 1. FDC-CORE.md を読む                          │
│    → 開発状況・技術スタック・3層アーキテクチャ  │
│    → ドキュメントインデックスで次を確認        │
└─────────────────────────────────────────────────┘
    │
    ├──────────────────────┬──────────────────────┐
    ▼                      ▼                      ▼
┌─────────────┐   ┌───────────────┐   ┌───────────────┐
│ 技術詳細が  │   │ Phase履歴が   │   │ セキュリティ  │
│ 必要な場合  │   │ 必要な場合    │   │ 詳細が必要な  │
│             │   │               │   │ 場合          │
│ DEVELOPMENT │   │ PHASE-        │   │ SECURITY-DB-  │
│ .md         │   │ HISTORY.md    │   │ DETAIL.md     │
└─────────────┘   └───────────────┘   └───────────────┘
```

---

## 5. ファイルサイズ比較

| ファイル | サイズ | 行数 | 備考 |
|---------|--------|------|------|
| **Before** |
| FDC-GRAND-GUIDE.md (v6.1) | ~128KB | ~2,700 | AIトークン超過 |
| **After** |
| FDC-GRAND-GUIDE.md (v7.0) | ~5KB | ~150 | インデックス |
| FDC-CORE.md | ~15KB | ~350 | 開発起点 |
| PHASE-HISTORY.md | ~35KB | ~800 | 履歴 |
| ARCHITECTURE-DETAIL.md | ~20KB | ~450 | アーキ詳細 |
| SECURITY-DB-DETAIL.md | ~25KB | ~550 | セキュリティ詳細 |
| OPS-LESSONS.md | ~15KB | ~350 | 運用教訓 |
| **合計** | ~115KB | ~2,650 | 分散化 |

**効果**:
- 開発起点（FDC-CORE.md）: 15KB → AIが1回で読み込み可能
- 必要な情報のみ参照 → 効率的な開発

---

**Last Updated**: 2025-12-02
**Product Version**: v2.8.8
**Status**: Phase 14.7 進行中（テナント別AI設定）- 14.7-A完了
**Tech Debt**: 0件（Lint/ビルド警告・`as any` ゼロ達成）
**Purpose**: FDC-GRAND-GUIDE.md 分割結果の可視化
