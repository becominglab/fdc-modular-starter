# Phase 14.7 ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ï¼šãƒ†ãƒŠãƒ³ãƒˆåˆ¥AIè¨­å®šãƒ»AIæ©Ÿèƒ½å®Ÿè£…

**Version:** 14.7.6
**Status:** âœ… 14.7-Aã€œCå®Œäº† â†’ **14.7-Dä»¥é™ã¯Phase 19ã¸ç§»è¡Œ**
**Claude Code ç”¨ãƒ©ãƒ³ãƒ–ãƒƒã‚¯**

> **é‡è¦**: Phase 14.7-Dã€œHã¯ **Phase 19** ã«ç§»è¡Œã—ã¾ã—ãŸã€‚
> è©³ç´°ã¯ `docs/runbooks/PHASE19-AI-IMPLEMENTATION-RUNBOOK.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## Phase 14.7 DODï¼ˆå®Œäº†å®šç¾©ï¼‰

æœ¬Phaseã®å®Œäº†æ¡ä»¶ï¼š

- [ ] å…¨ãƒ†ãƒŠãƒ³ãƒˆã§ ai_settings ãŒå®‰å…¨ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ disabledï¼‰
- [ ] SAãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ APIã‚­ãƒ¼/ãƒ¢ãƒ‡ãƒ«/ã‚¯ã‚©ãƒ¼ã‚¿ã®è¨­å®šãƒ»ç·¨é›†ãŒã§ãã‚‹
- [ ] AIç„¡åŠ¹ãƒ†ãƒŠãƒ³ãƒˆã§ AI UI ãŒè¡¨ç¤º/å‹•ä½œã—ãªã„ã“ã¨ã‚’ä¿è¨¼
- [ ] UC-01/02/03/08 ãŒ AIãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«ã‹ã‚‰å®Ÿè¡Œå¯èƒ½
- [ ] ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ä½¿ç”¨é‡ã®é›†è¨ˆãŒ API ãƒ¬ãƒ™ãƒ«ã§ã¯å–å¾—å¯èƒ½ï¼ˆUIã¯ç°¡æ˜“ã§ã‚‚å¯ï¼‰
- [ ] E2Eã‚·ãƒŠãƒªã‚ª #1ã€œ#5 ãŒã™ã¹ã¦ãƒ‘ã‚¹ã—ã¦ã„ã‚‹ã“ã¨ï¼ˆÂ§9.3 ãƒŸãƒ‹ãƒãƒ ãƒ†ã‚¹ãƒˆãƒãƒˆãƒªã‚¯ã‚¹å‚ç…§ï¼‰

### åˆå›ãƒ­ãƒ¼ãƒ³ãƒå¯¾è±¡

- **å…ˆè¡Œæ¤œè¨¼ãƒ†ãƒŠãƒ³ãƒˆ**: è‡ªç¤¾ãƒ†ãƒŠãƒ³ãƒˆï¼ˆFDCå†…éƒ¨ï¼‰
- **æ¤œè¨¼å¾Œ**: 1ç¤¾ã®ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆé¡§å®¢ã§æœ¬ç•ªæ¤œè¨¼ â†’ å…¨ãƒ†ãƒŠãƒ³ãƒˆå±•é–‹

---

## 0. æ¦‚è¦

Phase 14.6.5ï¼ˆAIåˆ©ç”¨è¨­è¨ˆï¼‰ã§å®šç¾©ã—ãŸãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ»UIè¨­è¨ˆã«åŸºã¥ãã€
**ãƒ†ãƒŠãƒ³ãƒˆåˆ¥AIè¨­å®š**ã¨**AIæ©Ÿèƒ½ã®æœ¬æ ¼å®Ÿè£…**ã‚’è¡Œã†ãƒ•ã‚§ãƒ¼ã‚ºã§ã™ã€‚

### 0.1 Phase 14.7 ã®ç›®çš„

1. **ãƒ†ãƒŠãƒ³ãƒˆåˆ¥AIè¨­å®š**: å„ãƒ†ãƒŠãƒ³ãƒˆãŒç‹¬è‡ªã®OpenAI APIã‚­ãƒ¼ã‚’è¨­å®šã—ã€AIæ©Ÿèƒ½ã®ã‚ªãƒ³/ã‚ªãƒ•ã‚’åˆ¶å¾¡
2. **AIæ©Ÿèƒ½å®Ÿè£…**: AIåˆ©ç”¨è¨­è¨ˆã«åŸºã¥ã„ãŸUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…
3. **AIç„¡åŠ¹æ™‚åˆ¶å¾¡**: AIæ©Ÿèƒ½ãŒä½¿ãˆãªã„å ´åˆã®é©åˆ‡ãªUIè¡¨ç¤º

### 0.2 å‰ææ¡ä»¶

| Phase | å†…å®¹ | çŠ¶æ…‹ |
|-------|------|------|
| Phase 14.4 | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåŸºç›¤ | âœ… å®Œäº† |
| Phase 14.6-A | ç›£æŸ»ãƒ­ã‚°ãƒ»ã‚¬ãƒãƒŠãƒ³ã‚¹ | âœ… å®Œäº† |
| Phase 14.6-B | ãƒ‡ãƒ¼ã‚¿æ•´å‚™ãƒ»æ­£è¦åŒ– | âœ… å®Œäº† |
| Phase 14.6-C | AIã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåŸºç›¤ | âœ… å®Œäº† |
| Phase 14.6-D | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»å¤‰æ•°ã‚·ã‚¹ãƒ†ãƒ  | âœ… å®Œäº† |
| Phase 14.6.5 | AIåˆ©ç”¨è¨­è¨ˆ | âœ… å®Œäº† |

### 0.2.1 ãƒ†ãƒŠãƒ³ãƒˆ vs ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ã‚¹ã‚³ãƒ¼ãƒ—

> **æœ¬Phaseã®ã‚¹ã‚³ãƒ¼ãƒ—**: ã€Œãƒ†ãƒŠãƒ³ãƒˆå˜ä½ã®AIåˆ©ç”¨å¯å¦ãƒ»ã‚­ãƒ¼è¨­å®šã€ã‚’æ‰±ã†ã€‚
> ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å˜ä½ã®ç´°åˆ†åŒ–ï¼ˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã”ã¨ã«AI ON/OFFç­‰ï¼‰ã¯ Phase 15 ä»¥é™ã§æ¤œè¨ã€‚
> FDCã§ã¯ãƒ†ãƒŠãƒ³ãƒˆ = å¥‘ç´„å˜ä½ã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ = ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§ã‚ã‚Šã€AI APIã‚­ãƒ¼/èª²é‡‘ã¯å¥‘ç´„å˜ä½ã§ç®¡ç†ã™ã‚‹è¨­è¨ˆã€‚

### 0.3 å¿…èª­ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/runbooks/PHASE14.6.5-AI-USAGE-DESIGN-RUNBOOK.md` - **AIåˆ©ç”¨è¨­è¨ˆï¼ˆå¿…èª­ï¼‰**
- `docs/runbooks/PHASE14.6-AI-READINESS-RUNBOOK.md` - AIå°å…¥æº–å‚™
- `lib/server/tenants.ts` - ãƒ†ãƒŠãƒ³ãƒˆè§£æ±ºãƒ¬ã‚¤ãƒ¤ãƒ¼
- `lib/server/encryption.ts` - æš—å·åŒ–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

### 0.4 ãƒ­ãƒ¼ãƒ«è¨­è¨ˆæ–¹é‡

| ãƒ­ãƒ¼ãƒ« | AIè¨­å®šå¤‰æ›´ | AIä½¿ç”¨é‡é–²è¦§ | AIæ©Ÿèƒ½åˆ©ç”¨ |
|--------|-----------|-------------|-----------|
| SAç®¡ç†è€… | âœ… å¯ | âœ… å¯ï¼ˆå…¨ãƒ†ãƒŠãƒ³ãƒˆï¼‰ | âœ… å¯ |
| ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€… | âŒ ä¸å¯ï¼ˆ14.7æ™‚ç‚¹ï¼‰ | ğŸ”œ å°†æ¥å¯¾å¿œ | âœ… å¯ |
| ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ | âŒ ä¸å¯ | ğŸ”œ æ®‹ã‚Šã‚¯ã‚©ãƒ¼ã‚¿ã®ã¿ | âœ… å¯ï¼ˆæœ‰åŠ¹æ™‚ï¼‰ |

> **Phase 14.7 æ™‚ç‚¹ã§ã¯ã€AIè¨­å®šå¤‰æ›´ã¯ SAç®¡ç†è€…ã®ã¿** ã«é™å®šã€‚
> ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€…ã«ã‚ˆã‚‹å¤‰æ›´ã¯å°†æ¥ãƒ•ã‚§ãƒ¼ã‚ºã§æ¤œè¨ã€‚
> ãƒ†ãƒŠãƒ³ãƒˆç”»é¢å†…ã«ã¯ã€ŒAIãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã€ã€Œæ®‹ã‚Šã‚¯ã‚©ãƒ¼ã‚¿ã€ã®**é–²è¦§ã®ã¿**ã‚’è¨±å¯ï¼ˆç·¨é›†ä¸å¯ï¼‰ã€‚

---

## 1. ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚ºä¸€è¦§

| ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | å„ªå…ˆåº¦ | é›£æ˜“åº¦ | ãƒœãƒªãƒ¥ãƒ¼ãƒ  | çŠ¶æ…‹ |
|-------------|------|--------|--------|-----------|------|
| **14.7-A** | DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»å‹å®šç¾©ãƒ»ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ | ğŸ”´ å¿…é ˆ | Low | S | âœ… å®Œäº† |
| **14.7-B** | APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ğŸ”´ å¿…é ˆ | Mid | M | â†’ Phase 19.1 |
| **14.7-C** | ãƒ†ãƒŠãƒ³ãƒˆAIè¨­å®šUI | ğŸ”´ å¿…é ˆ | Mid | M | â†’ Phase 19.2 |
| **14.7-D** | AIãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«ï¼ˆãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ï¼‰ | ğŸ”´ å¿…é ˆ | **High** | **L** | â†’ Phase 19.3 |
| **14.7-E** | AIä½¿ç”¨é‡ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° | ğŸŸ¡ æ¨å¥¨ | Mid | M | â†’ Phase 19.5 |
| **14.7-F** | AIã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆUI | ğŸŸ¡ æ¨å¥¨ | Low | S | â†’ Phase 19.6 |
| **14.7-G** | AIç„¡åŠ¹æ™‚ã®UIåˆ¶å¾¡ | ğŸ”´ å¿…é ˆ | Mid | M | â†’ Phase 19.4 |
| **14.7-H** | E2Eãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼ | ğŸŸ¡ æ¨å¥¨ | Mid | M | â†’ Phase 19.7 |

> **Phase 19ã¸ç§»è¡Œæ¸ˆã¿**: `docs/runbooks/PHASE19-AI-IMPLEMENTATION-RUNBOOK.md` å‚ç…§

> **é–‹ç™ºãƒªã‚¹ã‚¯é›†ä¸­**: 14.7-Dï¼ˆAIãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«ï¼‰ãŒæœ€ã‚‚é›£æ˜“åº¦ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒå¤§ãã„ã€‚
> **ãŠã™ã™ã‚å®Ÿè¡Œé †**: B(API) â†’ G(ç„¡åŠ¹æ™‚åˆ¶å¾¡æœ€ä½é™) â†’ D(ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«) â†’ C(è¨­å®šUI) â†’ E,F,H

---

## 2. Phase 14.7-A: åŸºç›¤å®Ÿè£… âœ… å®Œäº†

### 2.1 DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ãƒ•ã‚¡ã‚¤ãƒ«:** `migrations/023-tenant-ai-settings.sql`

```sql
ALTER TABLE tenants ADD COLUMN IF NOT EXISTS ai_settings JSONB NOT NULL DEFAULT '{
  "enabled": false,
  "api_key_encrypted": null,
  "model": "gpt-4o-mini",
  "quota": {
    "maxRequestsPerMonth": 1000,
    "maxTokensPerMonth": 500000,
    "maxCostPerMonth": 10.0
  }
}'::jsonb;

COMMENT ON COLUMN tenants.ai_settings IS 'ãƒ†ãƒŠãƒ³ãƒˆåˆ¥AIè¨­å®šï¼ˆPhase 14.7ï¼‰';

CREATE INDEX IF NOT EXISTS idx_tenants_ai_enabled
  ON tenants ((ai_settings->>'enabled'));
```

### 2.2 å‹å®šç¾©

**ãƒ•ã‚¡ã‚¤ãƒ«:** `lib/types/ai-settings.ts`

```typescript
interface TenantAISettings {
  enabled: boolean;
  api_key_encrypted: EncryptedData | null;
  model: 'gpt-4o-mini' | 'gpt-4o' | 'gpt-4-turbo' | 'gpt-3.5-turbo';
  quota: {
    maxRequestsPerMonth: number;
    maxTokensPerMonth: number;
    maxCostPerMonth: number;  // USD
  };
}

interface AIFeatureState {
  enabled: boolean;
  hasApiKey: boolean;
  available: boolean;
  disabledReason: 'none' | 'tenant_disabled' | 'no_api_key' | 'quota_exceeded';
}
```

**å‹ã®åˆ©ç”¨ç®‡æ‰€:**

| å‹ | åˆ©ç”¨ç®‡æ‰€ | ç”¨é€” |
|----|---------|------|
| `TenantAISettings` | DB / ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ / SAãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | è¨­å®šã®ä¿å­˜ãƒ»å–å¾—ãƒ»æ›´æ–°ã®æ­£è¦åŒ–å‹ |
| `AIFeatureState` | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ`useAIFeature()`ï¼‰ | AIãƒœã‚¿ãƒ³ã®ã‚ªãƒ³/ã‚ªãƒ•ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ¶å¾¡ã™ã‚‹çŠ¶æ…‹è¡¨ç¾ |

### 2.3 ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹

**ãƒ•ã‚¡ã‚¤ãƒ«:** `lib/server/tenant-ai-settings.ts`

å®Ÿè£…æ¸ˆã¿é–¢æ•°:
- `getTenantAISettings()` - è¨­å®šå–å¾—
- `getTenantApiKey()` - å¾©å·æ¸ˆã¿ã‚­ãƒ¼å–å¾—
- `updateTenantAISettings()` - è¨­å®šæ›´æ–°
- `validateOpenAIApiKey()` - ã‚­ãƒ¼æ¤œè¨¼
- `isTenantAIAvailable()` - åˆ©ç”¨å¯å¦åˆ¤å®š

### 2.4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] ai_settings ã‚«ãƒ©ãƒ è¿½åŠ 
- [x] TenantAISettings å‹å®šç¾©
- [x] AIFeatureState å‹å®šç¾©
- [x] ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
- [ ] æœ¬ç•ªDBé©ç”¨ï¼ˆæ‰‹å‹•å®Ÿè¡Œå¿…è¦ï¼‰

### 2.5 æœ¬ç•ªãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆæ‰‹é †

æ—¢å­˜ãƒ†ãƒŠãƒ³ãƒˆãŒã„ã‚‹çŠ¶æ…‹ã§ã®å®‰å…¨ãªé©ç”¨æ‰‹é †ï¼š

1. [ ] **æœ¬ç•ªDBãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—**
2. [ ] Stagingç’°å¢ƒã§ `023-tenant-ai-settings.sql` ã‚’é©ç”¨ãƒ»å‹•ä½œç¢ºèª
3. [ ] **æœ¬ç•ªé©ç”¨**: `psql` ã§æ‰‹å‹•å®Ÿè¡Œ
4. [ ] **æ¤œè¨¼**: æ—¢å­˜ãƒ†ãƒŠãƒ³ãƒˆã® `ai_settings.enabled` ãŒå…¨ã¦ `false` ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
   ```sql
   SELECT id, name, ai_settings->>'enabled' as ai_enabled
   FROM tenants;
   ```
5. [ ] SAãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§1ãƒ†ãƒŠãƒ³ãƒˆåˆ†ã‚’æ‰‹å‹•è¨­å®šã—ã€E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

---

## 3. Phase 14.7-B: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ğŸ”œ äºˆå®š

### 3.1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/api/admin/tenants/[id]/ai/route.ts`

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ |
|---------|------|------|
| GET | `/api/admin/tenants/[id]/ai` | AIè¨­å®šå–å¾— |
| PUT | `/api/admin/tenants/[id]/ai` | AIè¨­å®šæ›´æ–° |
| POST | `/api/admin/tenants/[id]/ai/validate` | APIã‚­ãƒ¼æ¤œè¨¼ |

### 3.2 APIä»•æ§˜

#### GET /api/admin/tenants/[id]/ai

**èªè¨¼:** SAç®¡ç†è€…ã®ã¿

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "enabled": true,
    "hasApiKey": true,
    "model": "gpt-4o-mini",
    "quota": {
      "maxRequestsPerMonth": 1000,
      "maxTokensPerMonth": 500000,
      "maxCostPerMonth": 10.0
    }
  }
}
```

#### PUT /api/admin/tenants/[id]/ai

**èªè¨¼:** SAç®¡ç†è€…ã®ã¿

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "enabled": true,
  "apiKey": "sk-...",
  "model": "gpt-4o-mini",
  "quota": {
    "maxRequestsPerMonth": 2000
  }
}
```

#### POST /api/admin/tenants/[id]/ai/validate

**èªè¨¼:** SAç®¡ç†è€…ã®ã¿

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "apiKey": "sk-..."
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "valid": true,
  "models": ["gpt-4o-mini", "gpt-4o", "gpt-3.5-turbo"]
}
```

### 3.3 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

| disabledReason | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ |
|----------------|---------------|-------------|
| `no_api_key` | 403 Forbidden | `{ "error": "no_api_key", "message": "APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“" }` |
| `tenant_disabled` | 403 Forbidden | `{ "error": "tenant_disabled", "message": "AIæ©Ÿèƒ½ã¯ã“ã®ãƒ†ãƒŠãƒ³ãƒˆã§ã¯ç„¡åŠ¹ã§ã™" }` |
| `quota_exceeded` | 429 Too Many Requests | `{ "error": "quota_exceeded", "message": "æœˆé–“ä½¿ç”¨é‡ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ", "resetAt": "2025-01-01T00:00:00Z" }` |

> **UI ã¨ã®é€£æº**: Phase 14.7-Gï¼ˆAIç„¡åŠ¹æ™‚UIåˆ¶å¾¡ï¼‰ã§ã“ã®ã‚¨ãƒ©ãƒ¼ã‚’ `useAIFeature()` ãŒè§£é‡ˆã—ã€é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã€‚

### 3.4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] GET ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
- [ ] PUT ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
- [ ] POST /validate ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
- [ ] èªè¨¼ãƒ»èªå¯ãƒã‚§ãƒƒã‚¯
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZodï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å®Ÿè£…ï¼ˆä¸Šè¨˜3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

---

## 4. Phase 14.7-C: ãƒ†ãƒŠãƒ³ãƒˆAIè¨­å®šUI ğŸ”œ äºˆå®š

### 4.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `app/_components/admin/sa-dashboard/TenantAISettingsPanel.tsx`ï¼ˆæ–°è¦ï¼‰
- `app/_components/admin/sa-dashboard/EditTenantModal.tsx`ï¼ˆæ‹¡å¼µï¼‰

### 4.2 UIè¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AIè¨­å®š                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ AIæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹        [====ON=====]                  â”‚
â”‚                                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                         â”‚
â”‚ OpenAI APIã‚­ãƒ¼                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [æ¤œè¨¼]  â”‚
â”‚ â”‚ sk-â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢       â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚ âœ… APIã‚­ãƒ¼æ¤œè¨¼æ¸ˆã¿                                       â”‚
â”‚                                                         â”‚
â”‚ ãƒ¢ãƒ‡ãƒ«                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ gpt-4o-mini (æ¨å¥¨)                     â–¼  â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                         â”‚
â”‚ ä½¿ç”¨é‡åˆ¶é™ï¼ˆæœˆé–“ï¼‰                                       â”‚
â”‚   ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                â”‚ 1000       â”‚ å›                       â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚   ãƒˆãƒ¼ã‚¯ãƒ³æ•°    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                â”‚ 500000     â”‚ ãƒˆãƒ¼ã‚¯ãƒ³                  â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚   ã‚³ã‚¹ãƒˆä¸Šé™    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                â”‚ 10.00      â”‚ USD                      â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] TenantAISettingsPanel ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] EditTenantModal ã«AIè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
- [ ] APIã‚­ãƒ¼å…¥åŠ›ï¼ˆãƒã‚¹ã‚¯è¡¨ç¤ºï¼‰
- [ ] ã‚­ãƒ¼æ¤œè¨¼ãƒœã‚¿ãƒ³ + çµæœè¡¨ç¤º
- [ ] ã‚ªãƒ³/ã‚ªãƒ•ãƒˆã‚°ãƒ«
- [ ] ãƒ¢ãƒ‡ãƒ«é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
- [ ] ã‚¯ã‚©ãƒ¼ã‚¿è¨­å®šå…¥åŠ›

---

## 5. Phase 14.7-D: AIãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« ğŸ”œ äºˆå®š

### 5.1 æ¦‚è¦

Phase 14.6.5 ã§è¨­è¨ˆã—ãŸAIãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«ï¼ˆã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ï¼‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### 5.1.1 UC â†” ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œè¡¨

| ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | UC | UseCaseKey | contextLevel |
|-------------------|-----|------------|--------------|
| ã€Œåˆå›ã‚³ãƒ³ã‚¿ã‚¯ãƒˆã€ãƒœã‚¿ãƒ³ | UC-01 | `initial_contact` | entity |
| ã€Œãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã€ãƒœã‚¿ãƒ³ | UC-02 | `follow_up` | entity |
| ã€Œåè«–å¯¾å¿œã€ãƒœã‚¿ãƒ³ | UC-03 | `objection_handling` | entity |
| ã€Œæ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒœã‚¿ãƒ³ | UC-08 | `next_action` | standard |

> **å‚ç…§**: Phase 14.6.5 ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ Â§2.1, Â§11.2

### 5.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `app/_components/ai/AIChatPanel.tsx`ï¼ˆæ–°è¦ï¼‰
- `app/_components/ai/AIChatMessage.tsx`ï¼ˆæ–°è¦ï¼‰
- `app/_components/ai/QuickActions.tsx`ï¼ˆæ–°è¦ï¼‰

### 5.3 UIè¨­è¨ˆï¼ˆå®Ÿè£…è¦³ç‚¹ã®è£œè¶³ï¼‰

> **UI æ­£æœ¬**: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»è¦ç´ ã®å®šç¾©ã¯ Phase 14.6.5 Â§5.2 ã‚’æ­£ã¨ã™ã‚‹ã€‚
> æœ¬ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã§ã¯å®Ÿè£…è¦³ç‚¹ã§ã®è£œè¶³ï¼ˆã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€çŠ¶æ…‹ç®¡ç†ãªã©ï¼‰ã®ã¿ã‚’è¨˜è¼‰ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ¨ FDCã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ            [Ã—]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ                      â”‚ â”‚
â”‚ â”‚ è¦‹è¾¼ã¿å®¢: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«           â”‚ â”‚
â”‚ â”‚ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ææ¡ˆä¸­                   â”‚ â”‚
â”‚ â”‚ [ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç·¨é›†]                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  [ä¼šè©±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸...]                     â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è³ªå•ã‚’å…¥åŠ›...                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ [ğŸ“] [é€ä¿¡ â¤]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³                   â”‚
â”‚ [åˆå›ã‚³ãƒ³ã‚¿ã‚¯ãƒˆ] [ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—]       â”‚
â”‚ [åè«–å¯¾å¿œ] [æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 æ©Ÿèƒ½è¦ä»¶

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­” | AIã®å¿œç­”ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º |
| ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º | ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºãƒ»ç·¨é›†å¯èƒ½ |
| ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å®šå‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®Ÿè¡Œ |
| ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ | AIå‡ºåŠ›ã‚’ã‚³ãƒ”ãƒ¼ |
| å†ç”Ÿæˆ | åˆ¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å†ç”Ÿæˆ |

### 5.5 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] AIChatPanel åŸºæœ¬å®Ÿè£…
- [ ] ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”è¡¨ç¤º
- [ ] ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ãƒ»é€ä¿¡
- [ ] ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
- [ ] ã‚³ãƒ”ãƒ¼ãƒ»å†ç”Ÿæˆãƒœã‚¿ãƒ³
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
- [ ] ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

---

## 6. Phase 14.7-E: AIä½¿ç”¨é‡ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° ğŸ”œ äºˆå®š

### 6.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `app/api/ai/usage/route.ts`ï¼ˆæ‹¡å¼µï¼‰
- `app/_components/admin/AIUsagePanel.tsx`ï¼ˆæ–°è¦ï¼‰

### 6.2 æ©Ÿèƒ½

- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥/ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã®AIä½¿ç”¨é‡è¡¨ç¤º
- æ—¥æ¬¡/é€±æ¬¡/æœˆæ¬¡é›†è¨ˆ
- ã‚³ã‚¹ãƒˆæ¨å®šè¡¨ç¤º
- ã‚¯ã‚©ãƒ¼ã‚¿è¶…éè­¦å‘Š

### 6.3 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ä½¿ç”¨é‡APIæ‹¡å¼µ
- [ ] AIUsagePanel UIå®Ÿè£…
- [ ] ã‚°ãƒ©ãƒ•è¡¨ç¤ºï¼ˆä½¿ç”¨é‡æ¨ç§»ï¼‰
- [ ] ã‚¯ã‚©ãƒ¼ã‚¿é€²æ—ãƒãƒ¼
- [ ] è­¦å‘Šè¡¨ç¤º

---

## 7. Phase 14.7-F: AIã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆUI ğŸ”œ äºˆå®š

### 7.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `app/_components/ai/ContextPreview.tsx`ï¼ˆæ–°è¦ï¼‰
- `app/_components/settings/AIContextSettings.tsx`ï¼ˆæ–°è¦ï¼‰

### 7.2 æ©Ÿèƒ½

- ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
- ãƒˆãƒ¼ã‚¯ãƒ³æ•°è¡¨ç¤º
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«è¨­å®šï¼ˆminimal / standard / detailedï¼‰
- å«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã®é¸æŠ

### 7.3 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ContextPreview å®Ÿè£…
- [ ] AIContextSettings å®Ÿè£…
- [ ] ãƒ¬ãƒ™ãƒ«é¸æŠUI
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º

---

## 8. Phase 14.7-G: AIç„¡åŠ¹æ™‚ã®UIåˆ¶å¾¡ ğŸ”œ äºˆå®š

### 8.1 æ¦‚è¦

ãƒ†ãƒŠãƒ³ãƒˆã§AIãŒç„¡åŠ¹ã®å ´åˆã€é–¢é€£UIã‚’é©åˆ‡ã«åˆ¶å¾¡ã—ã¾ã™ã€‚

### 8.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `lib/contexts/AIFeatureContext.tsx`ï¼ˆæ–°è¦ï¼‰
- `lib/hooks/useAIFeature.ts`ï¼ˆæ–°è¦ï¼‰

### 8.3 å½±éŸ¿ã‚’å—ã‘ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- `app/_components/ai/*` - AIãƒãƒ£ãƒƒãƒˆé–¢é€£
- `app/_components/okr/*` - OKR AIææ¡ˆ
- `app/_components/todo/*` - TODO AIæ©Ÿèƒ½
- `app/_components/dashboard/*` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰AI

### 8.4 ç„¡åŠ¹æ™‚ã®è¡¨ç¤ºãƒ‘ã‚¿ãƒ¼ãƒ³

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚   ğŸ”’ AIæ©Ÿèƒ½ã¯ã‚ªãƒ•ã§ã™                    â”‚
â”‚   ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„               â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³2: éè¡¨ç¤º**
- AIã‚¿ãƒ–è‡ªä½“ã‚’è¡¨ç¤ºã—ãªã„
- AIé–¢é€£ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º

### 8.5 ç„¡åŠ¹ç†ç”±åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

| ç†ç”± | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|------|-----------|
| `tenant_disabled` | AIæ©Ÿèƒ½ã¯ã“ã®ãƒ†ãƒŠãƒ³ãƒˆã§ã¯ç„¡åŠ¹ã§ã™ |
| `no_api_key` | APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ |
| `quota_exceeded` | æœˆé–“ä½¿ç”¨é‡ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚æ¥æœˆâ—‹æ—¥ä»¥é™ã«å†åº¦åˆ©ç”¨å¯èƒ½ã§ã™ |

### 8.5.1 UIè¦ç´ åˆ¥ã®ç„¡åŠ¹æ™‚æŒ™å‹•

| UIè¦ç´  | ç„¡åŠ¹æ™‚ã®æŒ™å‹• |
|--------|------------|
| ã‚°ãƒ­ãƒ¼ãƒãƒ«AIãƒœã‚¿ãƒ³ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰ | ãƒ›ãƒãƒ¼æ™‚ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§ç†ç”±è¡¨ç¤ºã€‚ã‚¯ãƒªãƒƒã‚¯ä¸å¯ï¼ˆdisabledï¼‰ |
| è¦‹è¾¼ã¿å®¢è©³ç´°ã®ã€ŒAIã§æ–‡ç« ä½œæˆã€ãƒœã‚¿ãƒ³ | disabled + ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º |
| ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ | éè¡¨ç¤ºï¼ˆAIãƒ‘ãƒãƒ«ãŒé–‹ã‘ãªã„ãŸã‚ï¼‰ |
| quotaè¶…éæ™‚ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + ã€Œæ¥æœˆâ—‹æ—¥ä»¥é™ã«å†åº¦åˆ©ç”¨å¯èƒ½ã€ã®æ—¥ä»˜è¡¨ç¤º |

### 8.6 useAIFeature() ä»•æ§˜

```typescript
// lib/hooks/useAIFeature.ts

interface UseAIFeatureResult {
  // AIFeatureStateï¼ˆ2.2 ã®å‹ã¨æ•´åˆï¼‰
  enabled: boolean;          // ai_settings.enabled
  hasApiKey: boolean;        // api_key_encrypted !== null
  available: boolean;        // enabled && hasApiKey && !quotaExceeded
  disabledReason: 'none' | 'tenant_disabled' | 'no_api_key' | 'quota_exceeded';

  // UIåˆ¶å¾¡ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
  canUseFeature: (feature: 'chat' | 'suggestion') => boolean;
  getDisabledMessage: () => string | null;
}

function useAIFeature(): UseAIFeatureResult;
```

**UIå´ã®è²¬å‹™**:
- `available === false` ã®ã¨ãã€ãƒœã‚¿ãƒ³ disable or ã‚«ãƒ¼ãƒ‰éè¡¨ç¤º
- `disabledReason !== 'none'` ã®ã¨ãã€`getDisabledMessage()` ã§ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— or ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
- å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯**è‡ªåˆ†ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’è§£é‡ˆã—ãªã„**ï¼ˆãƒ•ãƒƒã‚¯ã®è¿”ã‚Šå€¤ã‚’ãã®ã¾ã¾ä½¿ã†ï¼‰

### 8.7 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] AIFeatureContext ä½œæˆ
- [ ] useAIFeature() ãƒ•ãƒƒã‚¯
- [ ] å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç„¡åŠ¹æ™‚è¡¨ç¤º
- [ ] ç†ç”±åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

---

## 9. Phase 14.7-H: E2Eãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼ ğŸ”œ äºˆå®š

### 9.1 ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«:** `tests/e2e/ai-features.spec.ts`

### 9.2 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

```typescript
test.describe('AIæ©Ÿèƒ½', () => {
  test('AIæœ‰åŠ¹æ™‚ã«ãƒãƒ£ãƒƒãƒˆãŒä½¿ç”¨ã§ãã‚‹', async ({ page }) => {
    // ...
  });

  test('AIç„¡åŠ¹æ™‚ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
    // ...
  });

  test('ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒæ©Ÿèƒ½ã™ã‚‹', async ({ page }) => {
    // ...
  });

  test('APIã‚­ãƒ¼æ¤œè¨¼ãŒæ©Ÿèƒ½ã™ã‚‹', async ({ page }) => {
    // ...
  });
});
```

### 9.3 ãƒŸãƒ‹ãƒãƒ ãƒ†ã‚¹ãƒˆãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆå¿…é ˆï¼‰

| # | ã‚·ãƒŠãƒªã‚ª | å‰ææ¡ä»¶ | æœŸå¾…çµæœ |
|---|---------|---------|---------|
| 1 | APIã‚­ãƒ¼è¨­å®š â†’ validateæˆåŠŸ â†’ enabled=true | SAãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ | ãƒ†ãƒŠãƒ³ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIãƒãƒ£ãƒƒãƒˆã‚’é–‹ã‘ã‚‹ |
| 2 | APIã‚­ãƒ¼æœªè¨­å®š â†’ AIãƒœã‚¿ãƒ³æŠ¼ä¸‹ | ãƒ†ãƒŠãƒ³ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³ | ã€ŒAPIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€è¡¨ç¤º |
| 3 | quotaè¶…éçŠ¶æ…‹ â†’ AIãƒãƒ£ãƒƒãƒˆå®Ÿè¡Œ | æœˆé–“ä¸Šé™åˆ°é” | 429ã‚¨ãƒ©ãƒ¼ + ã€Œæ¥æœˆâ—‹æ—¥ä»¥é™ã«å†åº¦åˆ©ç”¨å¯èƒ½ã€è¡¨ç¤º |
| 4 | AIç„¡åŠ¹ãƒ†ãƒŠãƒ³ãƒˆ â†’ å„ç”»é¢ç¢ºèª | enabled=false | å…¨AIè¦ç´ ãŒdisabled/éè¡¨ç¤º |
| 5 | ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ | AIæœ‰åŠ¹ | UC-01/02/03/08 ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ |

> Playwrightç­‰ã§E2Eã‚’æ›¸ãéš›ã¯ã€ã“ã®5ã‚·ãƒŠãƒªã‚ªã‚’æœ€ä½é™ã‚«ãƒãƒ¼ã™ã‚‹ã“ã¨ã€‚

### 9.4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- [ ] AIç„¡åŠ¹æ™‚ã®å‹•ä½œãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆ
- [ ] APIã‚­ãƒ¼è¨­å®šãƒ†ã‚¹ãƒˆ
- [ ] ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆ
- [ ] ãƒŸãƒ‹ãƒãƒ ãƒ†ã‚¹ãƒˆãƒãƒˆãƒªã‚¯ã‚¹5ã‚·ãƒŠãƒªã‚ª

---

## 10. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 10.1 APIã‚­ãƒ¼ä¿è­·

| å¯¾ç­– | å®Ÿè£… |
|------|------|
| æš—å·åŒ–ä¿å­˜ | AES-256-GCMï¼ˆMASTER_ENCRYPTION_KEYä½¿ç”¨ï¼‰ |
| ãƒ­ã‚°é™¤å¤– | APIã‚­ãƒ¼ã¯ãƒ­ã‚°ã«å‡ºåŠ›ã—ãªã„ |
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹é™¤å¤– | hasApiKey ãƒ•ãƒ©ã‚°ã®ã¿è¿”ã™ |
| å¾©å·ã¯ã‚µãƒ¼ãƒãƒ¼ã®ã¿ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã¯ä¸€åˆ‡é€ä¿¡ã—ãªã„ |

### 10.2 APIã‚­ãƒ¼ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

| æ“ä½œ | Phase 14.7 å¯¾å¿œ | å‚™è€ƒ |
|------|----------------|------|
| **è¨­å®š** | âœ… å¯¾å¿œ | SAç®¡ç†è€…ãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰è¨­å®š |
| **æ›´æ–°** | âœ… å¯¾å¿œ | æ—¢å­˜ã‚­ãƒ¼ã‚’ä¸Šæ›¸ãã€‚å¤ã„ã‚­ãƒ¼ã¯å³æ™‚ç„¡åŠ¹ |
| **å‰Šé™¤** | âœ… å¯¾å¿œ | `api_key_encrypted = null` ã«è¨­å®š |
| **ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³** | ğŸ”œ å°†æ¥ | å±¥æ­´ç®¡ç†ãƒ»çŒ¶äºˆæœŸé–“ã¯å°†æ¥ãƒ•ã‚§ãƒ¼ã‚º |

### 10.3 ãƒ­ã‚°ãƒãƒªã‚·ãƒ¼

| é …ç›® | ãƒ­ã‚°å‡ºåŠ› | å‚™è€ƒ |
|------|---------|------|
| APIã‚­ãƒ¼ç”Ÿå€¤ | âŒ çµ¶å¯¾NG | |
| APIã‚­ãƒ¼å…ˆé ­4æ¡ | âŒ NG | éƒ¨åˆ†çš„ã«ã‚‚å‡ºã•ãªã„ |
| `sk-***...***` å½¢å¼ | âœ… OK | è¨­å®šæœ‰ç„¡ã®ç¢ºèªç”¨ |
| validateçµæœ | âœ… OK | `{ valid: true/false }` ã®ã¿ |
| DBã«ã¯æš—å·åŒ–å½¢å¼ã®ã¿ | âœ… | AES-256-GCM ã§æš—å·åŒ–ã•ã‚ŒãŸå½¢å¼ã®ã¿ä¿å­˜ |

### 10.4 ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

| æ“ä½œ | å¿…è¦æ¨©é™ |
|------|---------|
| AIè¨­å®šé–²è¦§ | SAç®¡ç†è€… |
| AIè¨­å®šæ›´æ–° | SAç®¡ç†è€… |
| APIã‚­ãƒ¼è¨­å®š | SAç®¡ç†è€… |
| AIæ©Ÿèƒ½åˆ©ç”¨ | ãƒ†ãƒŠãƒ³ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼ˆenabled && hasApiKeyæ™‚ï¼‰ |

---

## 11. æ—¢å­˜features.enableAIã¨ã®é–¢ä¿‚

| è¨­å®š | å ´æ‰€ | ç”¨é€” |
|------|------|------|
| `features.enableAI` | tenants.features | æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ï¼ˆUIè¡¨ç¤º/éè¡¨ç¤ºï¼‰ |
| `ai_settings.enabled` | tenants.ai_settings | å®Ÿéš›ã®AIæœ‰åŠ¹/ç„¡åŠ¹ |

**çµ±åˆãƒ­ã‚¸ãƒƒã‚¯:**
```typescript
const canUseAI =
  tenant.features.enableAI &&      // UIã«è¡¨ç¤ºã•ã‚Œã‚‹
  tenant.ai_settings.enabled &&    // è¨­å®šã§æœ‰åŠ¹
  tenant.ai_settings.api_key_encrypted !== null;  // ã‚­ãƒ¼è¨­å®šæ¸ˆã¿
```

### 11.1 AIæœ‰åŠ¹/ç„¡åŠ¹ çŠ¶æ…‹ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆçœŸç†å€¤è¡¨ï¼‰

| features.enableAI | ai_settings.enabled | api_key | quota | canUseAI | disabledReason | UIæŒ™å‹• |
|-------------------|---------------------|---------|-------|----------|----------------|--------|
| `false` | `false` | ãªã— | OK | `false` | `tenant_disabled` | AIé–¢é€£UIã‚’**éè¡¨ç¤º** |
| `true` | `false` | ãªã— | OK | `false` | `tenant_disabled` | ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| `true` | `true` | ãªã— | OK | `false` | `no_api_key` | ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| `true` | `true` | ã‚ã‚Š | è¶…é | `false` | `quota_exceeded` | ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + æ¬¡æœˆãƒªã‚»ãƒƒãƒˆæ—¥è¡¨ç¤º |
| `true` | `true` | ã‚ã‚Š | OK | `true` | `none` | **æ­£å¸¸åˆ©ç”¨å¯èƒ½** |

> **æ´»ç”¨**: `useAIFeature()` ã®å®Ÿè£…æ¤œè¨¼ã€ã€ŒONã«ã—ãŸã®ã«ä½¿ãˆãªã„ã€å•ã„åˆã‚ã›æ™‚ã®åˆ‡ã‚Šåˆ†ã‘ã«ä½¿ç”¨ã€‚

---

## 12. æˆæœç‰©ä¸€è¦§

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ | çŠ¶æ…‹ |
|----------|------|------|
| `migrations/023-tenant-ai-settings.sql` | DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… |
| `lib/types/ai-settings.ts` | å‹å®šç¾© | âœ… |
| `lib/server/tenant-ai-settings.ts` | ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ | âœ… |
| `app/api/admin/tenants/[id]/ai/route.ts` | API | ğŸ”œ |
| `app/_components/admin/sa-dashboard/TenantAISettingsPanel.tsx` | è¨­å®šUI | ğŸ”œ |
| `app/_components/ai/AIChatPanel.tsx` | ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« | ğŸ”œ |
| `app/_components/ai/ContextPreview.tsx` | ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ | ğŸ”œ |
| `app/_components/admin/AIUsagePanel.tsx` | ä½¿ç”¨é‡ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ğŸ”œ |
| `lib/hooks/useAIFeature.ts` | ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ | ğŸ”œ |
| `lib/contexts/AIFeatureContext.tsx` | Context | ğŸ”œ |
| `tests/e2e/ai-features.spec.ts` | E2Eãƒ†ã‚¹ãƒˆ | ğŸ”œ |

---

## 13. ç’°å¢ƒå¤‰æ•°

```bash
# å¿…é ˆï¼ˆæ—¢å­˜ï¼‰
MASTER_ENCRYPTION_KEY=<base64 or hex 32bytes>

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
OPENAI_API_KEY=sk-...        # ãƒ†ãƒŠãƒ³ãƒˆã‚­ãƒ¼æœªè¨­å®šæ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
AI_ENABLED=true              # ã‚°ãƒ­ãƒ¼ãƒãƒ«AIæœ‰åŠ¹ãƒ•ãƒ©ã‚°
```

---

## 14. ä¾å­˜é–¢ä¿‚

### 14.1 å‰æPhase

- Phase 14.4: ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåŸºç›¤ âœ…
- Phase 14.6: AIå°å…¥æº–å‚™ âœ…
- Phase 14.6.5: AIåˆ©ç”¨è¨­è¨ˆ âœ…

### 14.2 å¾Œç¶šPhase

- Phase 14.8: OKR AIçµ±åˆï¼ˆåˆ†æãƒ»ææ¡ˆï¼‰
- Phase 14.9: Action Map AIçµ±åˆï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- Phase 14.10: TODO AIçµ±åˆï¼ˆå„ªå…ˆé †ä½ãƒ»ç¿’æ…£ã‚³ãƒ¼ãƒï¼‰

---

## 15. æ¤œè¨¼ãƒ»å—ã‘å…¥ã‚ŒåŸºæº–

| é …ç›® | åŸºæº– |
|------|------|
| æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ | AIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ99.9%ç¨¼åƒç‡ã§å¿œç­” |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | å¹³å‡ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· â‰¤ 200msï¼ˆAIå¿œç­”é™¤ãï¼‰ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | APIã‚­ãƒ¼ãŒæ­£ã—ãæš—å·åŒ–ãƒ»ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ |
| UI | AIç„¡åŠ¹æ™‚ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | AIåˆ©ç”¨è¦ç´„ãŒãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã‚‹ |

---

## 16. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

1. **ãƒ‡ãƒ—ãƒ­ã‚¤å‰**: `git tag v14.7-release` ã‚’ä½œæˆ
2. **éšœå®³æ¤œçŸ¥**: AIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ¼ãƒˆ5%è¶…éã§ã‚¢ãƒ©ãƒ¼ãƒˆ
3. **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**: `git revert` ã§å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™
4. **ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯åˆ†é›¢ã—ã¦ç®¡ç†

### 16.1 DBãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ–¹é‡ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰

ç‰©ç†çš„ãªã‚«ãƒ©ãƒ å‰Šé™¤ã¯è¡Œã‚ãªã„ã€‚è«–ç†çš„ã«ç„¡åŠ¹åŒ–ã—ã¦å°†æ¥ã®å†æœ‰åŠ¹åŒ–ã«å‚™ãˆã‚‹ï¼š

```sql
-- å…¨ãƒ†ãƒŠãƒ³ãƒˆã®AIæ©Ÿèƒ½ã‚’è«–ç†çš„ã«ç„¡åŠ¹åŒ–
UPDATE tenants
SET ai_settings = jsonb_set(
  jsonb_set(ai_settings, '{enabled}', 'false'),
  '{api_key_encrypted}', 'null'
);

-- ç¢ºèª
SELECT id, name, ai_settings->>'enabled' as ai_enabled
FROM tenants;
```

> **æ³¨æ„**: `api_key_encrypted` ã‚’ null ã«ã™ã‚‹ã“ã¨ã§ã€ã‚­ãƒ¼æƒ…å ±ã‚‚è«–ç†å‰Šé™¤ã•ã‚Œã‚‹ã€‚
> ã‚«ãƒ©ãƒ è‡ªä½“ã¯æ®‹ã—ã€Phase 14.8 ä»¥é™ã§ã®å†æœ‰åŠ¹åŒ–ã‚’å‰æã¨ã™ã‚‹ã€‚

---

**ä½œæˆæ—¥:** 2025-12-02
**æœ€çµ‚æ›´æ–°:** 2025-12-05
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** âœ… 14.7-Aã€œCå®Œäº†ï¼ˆ14.7-Dä»¥é™ã¯Phase 19ã¸ç§»è¡Œï¼‰
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 14.7.6
