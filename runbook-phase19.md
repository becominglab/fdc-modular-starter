# Phase 19: MVVï¼ˆMission/Vision/Valueï¼‰çµ±åˆãƒ“ãƒ¥ãƒ¼

## ç›®æ¨™

MVVï¼ˆMission/Vision/Valueï¼‰ã‚’ç®¡ç†ã™ã‚‹çµ±åˆãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿè£…ï¼š
- Missionã€Visionã€Value ã®ç·¨é›†
- Brand + Lean Canvas + MVV ã®çµ±åˆè¡¨ç¤º
- æŠ˜ã‚Šç•³ã¿å¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

---

## MVVã¨ã¯

| è¦ç´  | æ„å‘³ | ä¾‹ |
|------|------|-----|
| Mission | å­˜åœ¨æ„ç¾©ãƒ»ä½¿å‘½ | ã€Œãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã§äººã€…ã‚’è±Šã‹ã«ã€ |
| Vision | å°†æ¥åƒ | ã€Œã™ã¹ã¦ã®äººãŒã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã«ã€ |
| Value | ä¾¡å€¤è¦³ãƒ»è¡Œå‹•æŒ‡é‡ | ã€Œå¤±æ•—ã‚’æã‚Œãšãƒãƒ£ãƒ¬ãƒ³ã‚¸ã€ |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MVV çµ±åˆãƒ“ãƒ¥ãƒ¼                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â–¼ ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ãƒ­ã‚´ãƒ»ã‚¿ã‚°ãƒ©ã‚¤ãƒ³ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â–¼ Missionï¼ˆä½¿å‘½ï¼‰                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã§äººã€…ã®ç”Ÿæ´»ã‚’è±Šã‹ã«ã™ã‚‹                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â–¼ Visionï¼ˆå°†æ¥åƒï¼‰                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ã™ã¹ã¦ã®äººãŒã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã«ãªã‚Œã‚‹ä¸–ç•Œ                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â–¼ Valuesï¼ˆä¾¡å€¤è¦³ï¼‰                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ å¤±æ•—ã‚’æã‚Œãšãƒãƒ£ãƒ¬ãƒ³ã‚¸                                      â”‚   â”‚
â”‚  â”‚  â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ                                          â”‚   â”‚
â”‚  â”‚  â€¢ é€æ˜æ€§ã®ã‚ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â–¶ Lean Canvas ã‚µãƒãƒªãƒ¼ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰                               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¿’å¾—ã™ã‚‹æ–°ã—ã„æ¦‚å¿µ

| æ¦‚å¿µ | èª¬æ˜ |
|------|------|
| MVV | Mission/Vision/Valueã€‚ä¼æ¥­ç†å¿µã®3è¦ç´  |
| çµ±åˆãƒ“ãƒ¥ãƒ¼ | è¤‡æ•°ã®æƒ…å ±ã‚’1ç”»é¢ã«ã¾ã¨ã‚ã¦è¡¨ç¤º |
| ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ | ã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ã§ãã‚‹æŠ˜ã‚Šç•³ã¿UI |
| JSONé…åˆ— | è¤‡æ•°ã®å€¤ã‚’1ã‚«ãƒ©ãƒ ã«ä¿å­˜ï¼ˆvaluesï¼‰ |

---

## å‰ææ¡ä»¶

- [ ] Phase 15 å®Œäº†ï¼ˆBrand å‹•ä½œï¼‰
- [ ] Phase 16 å®Œäº†ï¼ˆLean Canvas å‹•ä½œï¼‰
- [ ] é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹

---

## Step 1: DB ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### 1.1 MVV ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `supabase/migrations/20260113_phase19_mvv.sql`

```sql
-- ==============================================
-- Phase 19: MVVï¼ˆMission/Vision/Valueï¼‰
-- ==============================================

-- MVV ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE IF NOT EXISTS mvv (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  brand_id UUID NOT NULL REFERENCES brands(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  mission TEXT,
  vision TEXT,
  values JSONB DEFAULT '[]'::jsonb,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  -- 1ãƒ–ãƒ©ãƒ³ãƒ‰ã«1ã¤ã®MVV
  CONSTRAINT unique_brand_mvv UNIQUE (brand_id)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX IF NOT EXISTS idx_mvv_brand_id ON mvv(brand_id);
CREATE INDEX IF NOT EXISTS idx_mvv_user_id ON mvv(user_id);

-- RLS æœ‰åŠ¹åŒ–
ALTER TABLE mvv ENABLE ROW LEVEL SECURITY;

-- RLS ãƒãƒªã‚·ãƒ¼: è‡ªåˆ†ã®MVVã®ã¿
CREATE POLICY "Users can manage own mvv"
  ON mvv
  FOR ALL
  USING (auth.uid() = user_id)
  WITH CHECK (auth.uid() = user_id);

-- updated_at è‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
CREATE OR REPLACE FUNCTION update_mvv_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER mvv_updated_at
  BEFORE UPDATE ON mvv
  FOR EACH ROW
  EXECUTE FUNCTION update_mvv_updated_at();
```

### 1.2 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
supabase db push
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `mvv` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚ŒãŸ
- [ ] RLS ãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚ŒãŸ
- [ ] `unique_brand_mvv` åˆ¶ç´„ãŒè¨­å®šã•ã‚ŒãŸ

---

## Step 2: å‹å®šç¾©ã®ä½œæˆ

### 2.1 MVV å‹å®šç¾©

**ãƒ•ã‚¡ã‚¤ãƒ«:** `lib/types/mvv.ts`

```typescript
/**
 * lib/types/mvv.ts
 *
 * MVVï¼ˆMission/Vision/Valueï¼‰ã®å‹å®šç¾©
 */

// MVV ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
export interface MVV {
  id: string;
  brand_id: string;
  user_id: string;
  mission: string | null;
  vision: string | null;
  values: string[];
  created_at: string;
  updated_at: string;
}

// MVV ä½œæˆç”¨
export interface MVVCreate {
  brand_id: string;
  mission?: string | null;
  vision?: string | null;
  values?: string[];
}

// MVV æ›´æ–°ç”¨
export interface MVVUpdate {
  mission?: string | null;
  vision?: string | null;
  values?: string[];
}

// MVV ã‚»ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±
export const MVV_SECTION_INFO = {
  mission: {
    label: 'Mission',
    labelJa: 'ä½¿å‘½',
    description: 'ä¼šç¤¾ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®å­˜åœ¨æ„ç¾©ã€‚ãªãœå­˜åœ¨ã™ã‚‹ã®ã‹ï¼Ÿ',
    placeholder: 'ä¾‹: ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã§äººã€…ã®ç”Ÿæ´»ã‚’è±Šã‹ã«ã™ã‚‹',
    examples: [
      'ã™ã¹ã¦ã®äººã«å­¦ã³ã®æ©Ÿä¼šã‚’å±Šã‘ã‚‹',
      'æŒç¶šå¯èƒ½ãªç¤¾ä¼šã‚’æ¬¡ä¸–ä»£ã«æ®‹ã™',
      'ãƒ“ã‚¸ãƒã‚¹ã®æˆé•·ã‚’åŠ é€Ÿã•ã›ã‚‹',
    ],
  },
  vision: {
    label: 'Vision',
    labelJa: 'å°†æ¥åƒ',
    description: 'å®Ÿç¾ã—ãŸã„æœªæ¥ã®å§¿ã€‚ã©ã“ã‚’ç›®æŒ‡ã™ã®ã‹ï¼Ÿ',
    placeholder: 'ä¾‹: ã™ã¹ã¦ã®äººãŒã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã«ãªã‚Œã‚‹ä¸–ç•Œ',
    examples: [
      'èª°ã‚‚ãŒè‡ªåˆ†ã‚‰ã—ãåƒã‘ã‚‹ç¤¾ä¼š',
      'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨äººé–“ãŒå…±å­˜ã™ã‚‹æœªæ¥',
      'å›½å¢ƒã‚’è¶…ãˆã¦ã¤ãªãŒã‚‹ä¸–ç•Œ',
    ],
  },
  values: {
    label: 'Values',
    labelJa: 'ä¾¡å€¤è¦³',
    description: 'å¤§åˆ‡ã«ã™ã‚‹è¡Œå‹•æŒ‡é‡ã€‚ã©ã†è¡Œå‹•ã™ã‚‹ã‹ï¼Ÿ',
    placeholder: 'ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ',
    examples: [
      'å¤±æ•—ã‚’æã‚Œãšãƒãƒ£ãƒ¬ãƒ³ã‚¸',
      'é€æ˜æ€§ã®ã‚ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³',
      'ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’é‡è¦–ã™ã‚‹',
      'å¤šæ§˜æ€§ã‚’å°Šé‡ã™ã‚‹',
    ],
  },
};
```

### 2.2 Supabase å‹ã®æ›´æ–°

```bash
supabase gen types typescript --local > lib/supabase/database.types.ts
```

ç”Ÿæˆå¾Œã€`lib/types/database.ts` ã«ã‚³ãƒ”ãƒ¼ï¼š

```typescript
// lib/types/database.ts ã®æœ«å°¾ã«è¿½åŠ 

// MVV convenience types
export type MVVRow = Database['public']['Tables']['mvv']['Row'];
export type MVVInsert = Database['public']['Tables']['mvv']['Insert'];
export type MVVUpdate = Database['public']['Tables']['mvv']['Update'];
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `lib/types/mvv.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] MVV, MVVCreate, MVVUpdate å‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] MVV_SECTION_INFO ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹

---

## Step 3: API Routes ä½œæˆ

### 3.1 MVV å–å¾—ãƒ»ä½œæˆ API

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/api/mvv/route.ts`

```typescript
/**
 * app/api/mvv/route.ts
 *
 * GET /api/mvv?brandId=xxx - MVV å–å¾—
 * POST /api/mvv - MVV ä½œæˆ
 */

import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';
import { z } from 'zod';

const createMVVSchema = z.object({
  brand_id: z.string().uuid('æœ‰åŠ¹ãªãƒ–ãƒ©ãƒ³ãƒ‰IDã‚’æŒ‡å®šã—ã¦ãã ã•ã„'),
  mission: z.string().nullish(),
  vision: z.string().nullish(),
  values: z.array(z.string()).optional().default([]),
});

// GET: MVV å–å¾—
export async function GET(request: NextRequest) {
  try {
    const supabase = await createClient();
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    if (authError || !user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { searchParams } = new URL(request.url);
    const brandId = searchParams.get('brandId');

    if (!brandId) {
      return NextResponse.json({ error: 'brandId is required' }, { status: 400 });
    }

    // ãƒ–ãƒ©ãƒ³ãƒ‰æ‰€æœ‰è€…ç¢ºèª
    const { data: brand } = await supabase
      .from('brands')
      .select('id')
      .eq('id', brandId)
      .eq('user_id', user.id)
      .single();

    if (!brand) {
      return NextResponse.json({ error: 'Brand not found' }, { status: 404 });
    }

    // MVV å–å¾—
    const { data: mvv, error } = await supabase
      .from('mvv')
      .select('*')
      .eq('brand_id', brandId)
      .eq('user_id', user.id)
      .single();

    if (error && error.code !== 'PGRST116') {
      console.error('MVV fetch error:', error);
      return NextResponse.json({ error: 'Failed to fetch MVV' }, { status: 500 });
    }

    return NextResponse.json(mvv || null);
  } catch (error) {
    console.error('MVV GET error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// POST: MVV ä½œæˆ
export async function POST(request: NextRequest) {
  try {
    const supabase = await createClient();
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    if (authError || !user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const body = await request.json();
    const result = createMVVSchema.safeParse(body);

    if (!result.success) {
      return NextResponse.json(
        { error: 'Invalid input', issues: result.error.issues },
        { status: 400 }
      );
    }

    // ãƒ–ãƒ©ãƒ³ãƒ‰æ‰€æœ‰è€…ç¢ºèª
    const { data: brand } = await supabase
      .from('brands')
      .select('id')
      .eq('id', result.data.brand_id)
      .eq('user_id', user.id)
      .single();

    if (!brand) {
      return NextResponse.json({ error: 'Brand not found' }, { status: 404 });
    }

    // æ—¢å­˜MVVç¢ºèª
    const { data: existingMVV } = await supabase
      .from('mvv')
      .select('id')
      .eq('brand_id', result.data.brand_id)
      .single();

    if (existingMVV) {
      return NextResponse.json(
        { error: 'MVV already exists for this brand' },
        { status: 409 }
      );
    }

    // MVV ä½œæˆ
    const { data: mvv, error: createError } = await supabase
      .from('mvv')
      .insert({
        brand_id: result.data.brand_id,
        user_id: user.id,
        mission: result.data.mission || null,
        vision: result.data.vision || null,
        values: result.data.values || [],
      })
      .select()
      .single();

    if (createError) {
      console.error('MVV create error:', createError);
      return NextResponse.json({ error: 'Failed to create MVV' }, { status: 500 });
    }

    return NextResponse.json(mvv, { status: 201 });
  } catch (error) {
    console.error('MVV POST error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}
```

### 3.2 MVV æ›´æ–°ãƒ»å‰Šé™¤ API

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/api/mvv/[mvvId]/route.ts`

```typescript
/**
 * app/api/mvv/[mvvId]/route.ts
 *
 * GET /api/mvv/:mvvId - MVV è©³ç´°å–å¾—
 * PATCH /api/mvv/:mvvId - MVV æ›´æ–°
 * DELETE /api/mvv/:mvvId - MVV å‰Šé™¤
 */

import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';
import { z } from 'zod';

const updateMVVSchema = z.object({
  mission: z.string().nullish(),
  vision: z.string().nullish(),
  values: z.array(z.string()).optional(),
});

// GET: MVV è©³ç´°å–å¾—
export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ mvvId: string }> }
) {
  try {
    const { mvvId } = await params;
    const supabase = await createClient();
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    if (authError || !user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { data: mvv, error } = await supabase
      .from('mvv')
      .select('*')
      .eq('id', mvvId)
      .eq('user_id', user.id)
      .single();

    if (error || !mvv) {
      return NextResponse.json({ error: 'MVV not found' }, { status: 404 });
    }

    return NextResponse.json(mvv);
  } catch (error) {
    console.error('MVV GET error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// PATCH: MVV æ›´æ–°
export async function PATCH(
  request: NextRequest,
  { params }: { params: Promise<{ mvvId: string }> }
) {
  try {
    const { mvvId } = await params;
    const supabase = await createClient();
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    if (authError || !user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const body = await request.json();
    const result = updateMVVSchema.safeParse(body);

    if (!result.success) {
      return NextResponse.json(
        { error: 'Invalid input', issues: result.error.issues },
        { status: 400 }
      );
    }

    const { data: mvv, error: updateError } = await supabase
      .from('mvv')
      .update({
        ...result.data,
        updated_at: new Date().toISOString(),
      })
      .eq('id', mvvId)
      .eq('user_id', user.id)
      .select()
      .single();

    if (updateError) {
      console.error('MVV update error:', updateError);
      return NextResponse.json({ error: 'Failed to update MVV' }, { status: 500 });
    }

    return NextResponse.json(mvv);
  } catch (error) {
    console.error('MVV PATCH error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// DELETE: MVV å‰Šé™¤
export async function DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ mvvId: string }> }
) {
  try {
    const { mvvId } = await params;
    const supabase = await createClient();
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    if (authError || !user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { error: deleteError } = await supabase
      .from('mvv')
      .delete()
      .eq('id', mvvId)
      .eq('user_id', user.id);

    if (deleteError) {
      console.error('MVV delete error:', deleteError);
      return NextResponse.json({ error: 'Failed to delete MVV' }, { status: 500 });
    }

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('MVV DELETE error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `app/api/mvv/route.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `app/api/mvv/[mvvId]/route.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] GET, POST, PATCH, DELETE ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

---

## Step 4: React Hooks ä½œæˆ

### 4.1 MVV Hook

**ãƒ•ã‚¡ã‚¤ãƒ«:** `lib/hooks/useMVV.ts`

```typescript
/**
 * lib/hooks/useMVV.ts
 *
 * MVV ç®¡ç†ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
 */

import { useState, useEffect, useCallback } from 'react';
import type { MVV, MVVCreate, MVVUpdate } from '@/lib/types/mvv';

export function useMVV(brandId: string | null) {
  const [mvv, setMVV] = useState<MVV | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [saving, setSaving] = useState(false);

  const fetchMVV = useCallback(async () => {
    if (!brandId) {
      setMVV(null);
      return;
    }

    try {
      setLoading(true);
      setError(null);

      const res = await fetch(`/api/mvv?brandId=${brandId}`);
      if (!res.ok && res.status !== 404) {
        throw new Error('Failed to fetch MVV');
      }

      const data = await res.json();
      setMVV(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Unknown error');
    } finally {
      setLoading(false);
    }
  }, [brandId]);

  useEffect(() => {
    fetchMVV();
  }, [fetchMVV]);

  // MVV ä½œæˆ
  const createMVV = async (input: MVVCreate): Promise<MVV | null> => {
    try {
      setSaving(true);
      setError(null);

      const res = await fetch('/api/mvv', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(input),
      });

      if (!res.ok) throw new Error('Failed to create MVV');

      const created = await res.json();
      setMVV(created);
      return created;
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Unknown error');
      return null;
    } finally {
      setSaving(false);
    }
  };

  // MVV æ›´æ–°
  const updateMVV = async (input: MVVUpdate): Promise<boolean> => {
    if (!mvv) return false;

    try {
      setSaving(true);
      setError(null);

      const res = await fetch(`/api/mvv/${mvv.id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(input),
      });

      if (!res.ok) throw new Error('Failed to update MVV');

      const updated = await res.json();
      setMVV(updated);
      return true;
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Unknown error');
      return false;
    } finally {
      setSaving(false);
    }
  };

  // MVV ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ï¼ˆupsertçš„ãªå‹•ä½œï¼‰
  const saveMVV = async (input: MVVUpdate): Promise<boolean> => {
    if (!brandId) return false;

    if (mvv) {
      return await updateMVV(input);
    } else {
      const created = await createMVV({ ...input, brand_id: brandId });
      return !!created;
    }
  };

  // Value è¿½åŠ 
  const addValue = async (value: string): Promise<boolean> => {
    if (!value.trim()) return false;
    const newValues = [...(mvv?.values || []), value.trim()];
    return await saveMVV({ values: newValues });
  };

  // Value å‰Šé™¤
  const removeValue = async (index: number): Promise<boolean> => {
    const newValues = (mvv?.values || []).filter((_, i) => i !== index);
    return await saveMVV({ values: newValues });
  };

  // Value æ›´æ–°
  const updateValue = async (index: number, value: string): Promise<boolean> => {
    const newValues = [...(mvv?.values || [])];
    newValues[index] = value;
    return await saveMVV({ values: newValues });
  };

  return {
    mvv,
    loading,
    error,
    saving,
    refetch: fetchMVV,
    createMVV,
    updateMVV,
    saveMVV,
    addValue,
    removeValue,
    updateValue,
  };
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `lib/hooks/useMVV.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] saveMVV ã§ upsert å‹•ä½œãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

---

## Step 5: UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ

### 5.1 æŠ˜ã‚Šç•³ã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/mvv/Collapsible.tsx`

```typescript
'use client';

/**
 * components/mvv/Collapsible.tsx
 *
 * æŠ˜ã‚Šç•³ã¿ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 */

import { useState } from 'react';
import { ChevronDown, ChevronRight } from 'lucide-react';

interface CollapsibleProps {
  title: string;
  subtitle?: string;
  defaultOpen?: boolean;
  children: React.ReactNode;
  className?: string;
}

export function Collapsible({
  title,
  subtitle,
  defaultOpen = false,
  children,
  className = '',
}: CollapsibleProps) {
  const [isOpen, setIsOpen] = useState(defaultOpen);

  return (
    <div className={`collapsible ${isOpen ? 'open' : ''} ${className}`}>
      <button
        type="button"
        onClick={() => setIsOpen(!isOpen)}
        className="collapsible-header"
        aria-expanded={isOpen}
      >
        <div className="collapsible-icon">
          {isOpen ? <ChevronDown size={20} /> : <ChevronRight size={20} />}
        </div>
        <div className="collapsible-title">
          <span className="title-text">{title}</span>
          {subtitle && <span className="subtitle-text">{subtitle}</span>}
        </div>
      </button>
      {isOpen && (
        <div className="collapsible-content">
          {children}
        </div>
      )}
    </div>
  );
}
```

### 5.2 MVV ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/mvv/MVVSection.tsx`

```typescript
'use client';

/**
 * components/mvv/MVVSection.tsx
 *
 * MVVï¼ˆMission/Vision/Valueï¼‰ç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³
 */

import { useState } from 'react';
import { Edit, Save, X, Plus, Trash2, Loader2, Target, Eye, Heart } from 'lucide-react';
import type { MVV, MVVUpdate } from '@/lib/types/mvv';
import { MVV_SECTION_INFO } from '@/lib/types/mvv';

interface MVVSectionProps {
  mvv: MVV | null;
  saving: boolean;
  onSave: (data: MVVUpdate) => Promise<boolean>;
  onAddValue: (value: string) => Promise<boolean>;
  onRemoveValue: (index: number) => Promise<boolean>;
  onUpdateValue: (index: number, value: string) => Promise<boolean>;
}

export function MVVSection({
  mvv,
  saving,
  onSave,
  onAddValue,
  onRemoveValue,
  onUpdateValue,
}: MVVSectionProps) {
  const [editingField, setEditingField] = useState<'mission' | 'vision' | null>(null);
  const [editValue, setEditValue] = useState('');
  const [newValue, setNewValue] = useState('');
  const [editingValueIndex, setEditingValueIndex] = useState<number | null>(null);
  const [editingValueText, setEditingValueText] = useState('');

  const handleEditStart = (field: 'mission' | 'vision') => {
    setEditingField(field);
    setEditValue(mvv?.[field] || '');
  };

  const handleEditSave = async () => {
    if (!editingField) return;
    const success = await onSave({ [editingField]: editValue.trim() || null });
    if (success) {
      setEditingField(null);
      setEditValue('');
    }
  };

  const handleEditCancel = () => {
    setEditingField(null);
    setEditValue('');
  };

  const handleAddValue = async () => {
    if (!newValue.trim()) return;
    const success = await onAddValue(newValue.trim());
    if (success) {
      setNewValue('');
    }
  };

  const handleValueEditStart = (index: number) => {
    setEditingValueIndex(index);
    setEditingValueText(mvv?.values[index] || '');
  };

  const handleValueEditSave = async () => {
    if (editingValueIndex === null) return;
    const success = await onUpdateValue(editingValueIndex, editingValueText.trim());
    if (success) {
      setEditingValueIndex(null);
      setEditingValueText('');
    }
  };

  const sectionIcons = {
    mission: Target,
    vision: Eye,
    values: Heart,
  };

  return (
    <div className="mvv-section">
      {/* Mission */}
      <div className="mvv-item">
        <div className="mvv-item-header">
          <div className="mvv-item-icon mission">
            <Target size={20} />
          </div>
          <div className="mvv-item-label">
            <h3>{MVV_SECTION_INFO.mission.label}</h3>
            <span className="label-ja">{MVV_SECTION_INFO.mission.labelJa}</span>
          </div>
          {editingField !== 'mission' && (
            <button
              onClick={() => handleEditStart('mission')}
              className="btn-icon"
              disabled={saving}
            >
              <Edit size={16} />
            </button>
          )}
        </div>
        <p className="mvv-item-description">{MVV_SECTION_INFO.mission.description}</p>

        {editingField === 'mission' ? (
          <div className="mvv-edit-form">
            <textarea
              value={editValue}
              onChange={(e) => setEditValue(e.target.value)}
              placeholder={MVV_SECTION_INFO.mission.placeholder}
              className="form-textarea"
              rows={3}
              autoFocus
            />
            <div className="edit-actions">
              <button onClick={handleEditCancel} className="btn btn-secondary" disabled={saving}>
                <X size={14} /> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
              </button>
              <button onClick={handleEditSave} className="btn btn-primary" disabled={saving}>
                {saving ? <Loader2 className="animate-spin" size={14} /> : <Save size={14} />}
                ä¿å­˜
              </button>
            </div>
          </div>
        ) : (
          <div className="mvv-item-content">
            {mvv?.mission ? (
              <p className="content-text">{mvv.mission}</p>
            ) : (
              <p className="content-empty">æœªè¨­å®š</p>
            )}
          </div>
        )}
      </div>

      {/* Vision */}
      <div className="mvv-item">
        <div className="mvv-item-header">
          <div className="mvv-item-icon vision">
            <Eye size={20} />
          </div>
          <div className="mvv-item-label">
            <h3>{MVV_SECTION_INFO.vision.label}</h3>
            <span className="label-ja">{MVV_SECTION_INFO.vision.labelJa}</span>
          </div>
          {editingField !== 'vision' && (
            <button
              onClick={() => handleEditStart('vision')}
              className="btn-icon"
              disabled={saving}
            >
              <Edit size={16} />
            </button>
          )}
        </div>
        <p className="mvv-item-description">{MVV_SECTION_INFO.vision.description}</p>

        {editingField === 'vision' ? (
          <div className="mvv-edit-form">
            <textarea
              value={editValue}
              onChange={(e) => setEditValue(e.target.value)}
              placeholder={MVV_SECTION_INFO.vision.placeholder}
              className="form-textarea"
              rows={3}
              autoFocus
            />
            <div className="edit-actions">
              <button onClick={handleEditCancel} className="btn btn-secondary" disabled={saving}>
                <X size={14} /> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
              </button>
              <button onClick={handleEditSave} className="btn btn-primary" disabled={saving}>
                {saving ? <Loader2 className="animate-spin" size={14} /> : <Save size={14} />}
                ä¿å­˜
              </button>
            </div>
          </div>
        ) : (
          <div className="mvv-item-content">
            {mvv?.vision ? (
              <p className="content-text">{mvv.vision}</p>
            ) : (
              <p className="content-empty">æœªè¨­å®š</p>
            )}
          </div>
        )}
      </div>

      {/* Values */}
      <div className="mvv-item values">
        <div className="mvv-item-header">
          <div className="mvv-item-icon values">
            <Heart size={20} />
          </div>
          <div className="mvv-item-label">
            <h3>{MVV_SECTION_INFO.values.label}</h3>
            <span className="label-ja">{MVV_SECTION_INFO.values.labelJa}</span>
          </div>
        </div>
        <p className="mvv-item-description">{MVV_SECTION_INFO.values.description}</p>

        <div className="values-list">
          {(mvv?.values || []).map((value, index) => (
            <div key={index} className="value-item">
              {editingValueIndex === index ? (
                <div className="value-edit">
                  <input
                    type="text"
                    value={editingValueText}
                    onChange={(e) => setEditingValueText(e.target.value)}
                    className="form-input"
                    autoFocus
                    onKeyDown={(e) => {
                      if (e.key === 'Enter') handleValueEditSave();
                      if (e.key === 'Escape') {
                        setEditingValueIndex(null);
                        setEditingValueText('');
                      }
                    }}
                  />
                  <button
                    onClick={handleValueEditSave}
                    className="btn-icon"
                    disabled={saving}
                  >
                    <Save size={14} />
                  </button>
                  <button
                    onClick={() => {
                      setEditingValueIndex(null);
                      setEditingValueText('');
                    }}
                    className="btn-icon"
                  >
                    <X size={14} />
                  </button>
                </div>
              ) : (
                <>
                  <span className="value-text">{value}</span>
                  <div className="value-actions">
                    <button
                      onClick={() => handleValueEditStart(index)}
                      className="btn-icon"
                      disabled={saving}
                    >
                      <Edit size={14} />
                    </button>
                    <button
                      onClick={() => onRemoveValue(index)}
                      className="btn-icon btn-danger"
                      disabled={saving}
                    >
                      <Trash2 size={14} />
                    </button>
                  </div>
                </>
              )}
            </div>
          ))}
        </div>

        <div className="value-add">
          <input
            type="text"
            value={newValue}
            onChange={(e) => setNewValue(e.target.value)}
            placeholder={MVV_SECTION_INFO.values.placeholder}
            className="form-input"
            onKeyDown={(e) => {
              if (e.key === 'Enter') handleAddValue();
            }}
          />
          <button
            onClick={handleAddValue}
            className="btn btn-outline"
            disabled={saving || !newValue.trim()}
          >
            <Plus size={14} /> è¿½åŠ 
          </button>
        </div>

        {/* ä¾‹ */}
        <div className="values-examples">
          <span className="examples-label">ä¾‹:</span>
          {MVV_SECTION_INFO.values.examples.map((example, i) => (
            <button
              key={i}
              onClick={() => setNewValue(example)}
              className="example-chip"
            >
              {example}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
}
```

### 5.3 çµ±åˆãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/mvv/UnifiedView.tsx`

```typescript
'use client';

/**
 * components/mvv/UnifiedView.tsx
 *
 * Brand + Lean Canvas + MVV çµ±åˆãƒ“ãƒ¥ãƒ¼
 */

import Link from 'next/link';
import { Palette, LayoutGrid, Target, Edit } from 'lucide-react';
import type { Brand } from '@/lib/types/brand';
import type { LeanCanvas, LeanCanvasBlock } from '@/lib/types/lean-canvas';
import type { MVV } from '@/lib/types/mvv';
import { Collapsible } from './Collapsible';
import { LEAN_CANVAS_BLOCK_INFO } from '@/lib/types/lean-canvas';

interface UnifiedViewProps {
  brand: Brand;
  leanCanvas: (LeanCanvas & { blocks: LeanCanvasBlock[] }) | null;
  mvv: MVV | null;
}

export function UnifiedView({ brand, leanCanvas, mvv }: UnifiedViewProps) {
  return (
    <div className="unified-view">
      {/* ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦ */}
      <Collapsible title="ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦" subtitle={brand.name} defaultOpen>
        <div className="unified-brand">
          <div className="brand-header">
            {brand.logo_url && (
              <img src={brand.logo_url} alt={brand.name} className="brand-logo" />
            )}
            <div className="brand-info">
              <h3>{brand.name}</h3>
              {brand.tagline && <p className="tagline">{brand.tagline}</p>}
            </div>
            <Link href="/brand" className="edit-link">
              <Edit size={14} />
            </Link>
          </div>
          {brand.story && <p className="brand-story">{brand.story}</p>}
        </div>
      </Collapsible>

      {/* MVV */}
      <Collapsible title="MVV" subtitle="Mission / Vision / Values" defaultOpen>
        <div className="unified-mvv">
          {mvv ? (
            <div className="mvv-summary">
              <div className="mvv-summary-item">
                <span className="label">Mission</span>
                <p>{mvv.mission || 'æœªè¨­å®š'}</p>
              </div>
              <div className="mvv-summary-item">
                <span className="label">Vision</span>
                <p>{mvv.vision || 'æœªè¨­å®š'}</p>
              </div>
              <div className="mvv-summary-item">
                <span className="label">Values</span>
                {mvv.values.length > 0 ? (
                  <ul className="values-list">
                    {mvv.values.map((v, i) => (
                      <li key={i}>{v}</li>
                    ))}
                  </ul>
                ) : (
                  <p>æœªè¨­å®š</p>
                )}
              </div>
            </div>
          ) : (
            <p className="empty-message">MVV ãŒæœªè¨­å®šã§ã™</p>
          )}
        </div>
      </Collapsible>

      {/* Lean Canvas ã‚µãƒãƒªãƒ¼ */}
      <Collapsible title="Lean Canvas" subtitle={leanCanvas?.title}>
        {leanCanvas ? (
          <div className="unified-canvas">
            <div className="canvas-summary-grid">
              {['problem', 'customer-segments', 'unique-value', 'solution'].map(blockType => {
                const block = leanCanvas.blocks.find(b => b.block_type === blockType);
                const content = block?.content as { items?: string[] } | undefined;
                const info = LEAN_CANVAS_BLOCK_INFO[blockType as keyof typeof LEAN_CANVAS_BLOCK_INFO];

                return (
                  <div key={blockType} className="canvas-summary-item">
                    <span className="label">{info?.label}</span>
                    {content?.items && content.items.length > 0 ? (
                      <ul>
                        {content.items.slice(0, 2).map((item, i) => (
                          <li key={i}>{item}</li>
                        ))}
                        {content.items.length > 2 && (
                          <li className="more">+{content.items.length - 2}ä»¶</li>
                        )}
                      </ul>
                    ) : (
                      <p className="empty">æœªå…¥åŠ›</p>
                    )}
                  </div>
                );
              })}
            </div>
            <Link href={`/lean-canvas/${leanCanvas.id}`} className="view-full-link">
              å…¨ä½“ã‚’è¦‹ã‚‹
            </Link>
          </div>
        ) : (
          <div className="empty-message">
            <p>Lean Canvas ãŒã‚ã‚Šã¾ã›ã‚“</p>
            <Link href="/lean-canvas" className="btn btn-outline">
              ä½œæˆã™ã‚‹
            </Link>
          </div>
        )}
      </Collapsible>
    </div>
  );
}
```

### 5.4 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/mvv/index.ts`

```typescript
export { Collapsible } from './Collapsible';
export { MVVSection } from './MVVSection';
export { UnifiedView } from './UnifiedView';
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `components/mvv/Collapsible.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `components/mvv/MVVSection.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `components/mvv/UnifiedView.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `components/mvv/index.ts` ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹

---

## Step 6: MVV ãƒšãƒ¼ã‚¸ä½œæˆ

### 6.1 MVV çµ±åˆãƒšãƒ¼ã‚¸

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/(app)/mvv/page.tsx`

```typescript
'use client';

/**
 * app/(app)/mvv/page.tsx
 *
 * MVV çµ±åˆãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸
 */

import { useState, useEffect } from 'react';
import { Target, Loader2, ChevronDown } from 'lucide-react';
import { useBrands } from '@/lib/hooks/useBrand';
import { useMVV } from '@/lib/hooks/useMVV';
import { MVVSection, UnifiedView } from '@/components/mvv';

export default function MVVPage() {
  const { brands, isLoading: brandsLoading } = useBrands();
  const [selectedBrandId, setSelectedBrandId] = useState<string | null>(null);
  const [leanCanvas, setLeanCanvas] = useState<any>(null);
  const [leanCanvasLoading, setLeanCanvasLoading] = useState(false);

  // ãƒ–ãƒ©ãƒ³ãƒ‰ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰æœ€åˆã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’é¸æŠ
  useEffect(() => {
    if (!selectedBrandId && brands.length > 0) {
      setSelectedBrandId(brands[0].id);
    }
  }, [brands, selectedBrandId]);

  const selectedBrand = brands.find(b => b.id === selectedBrandId) || null;
  const { mvv, loading, saving, saveMVV, addValue, removeValue, updateValue } = useMVV(selectedBrandId);

  // Lean Canvas å–å¾—
  useEffect(() => {
    if (!selectedBrandId) {
      setLeanCanvas(null);
      return;
    }

    const fetchLeanCanvas = async () => {
      setLeanCanvasLoading(true);
      try {
        const res = await fetch(`/api/lean-canvas?brandId=${selectedBrandId}`);
        if (res.ok) {
          const canvases = await res.json();
          if (canvases.length > 0) {
            // æœ€æ–°ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’å–å¾—
            const latestCanvas = canvases[0];
            const blocksRes = await fetch(`/api/lean-canvas/${latestCanvas.id}`);
            if (blocksRes.ok) {
              const canvasWithBlocks = await blocksRes.json();
              setLeanCanvas(canvasWithBlocks);
            }
          } else {
            setLeanCanvas(null);
          }
        }
      } catch (error) {
        console.error('Failed to fetch Lean Canvas:', error);
      } finally {
        setLeanCanvasLoading(false);
      }
    };

    fetchLeanCanvas();
  }, [selectedBrandId]);

  if (brandsLoading) {
    return (
      <div className="page-loading">
        <Loader2 className="animate-spin" size={32} />
        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    );
  }

  if (brands.length === 0) {
    return (
      <div className="mvv-page">
        <header className="page-header">
          <div className="header-content">
            <Target size={24} />
            <h1>MVV</h1>
          </div>
        </header>
        <div className="empty-state">
          <Target size={48} />
          <h2>ãƒ–ãƒ©ãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“</h2>
          <p>ã¾ãšã€Œãƒ–ãƒ©ãƒ³ãƒ‰ã€ã‚¿ãƒ–ã§ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
        </div>
      </div>
    );
  }

  return (
    <div className="mvv-page">
      <header className="page-header">
        <div className="header-content">
          <Target size={24} />
          <h1>MVV</h1>
          <span className="header-subtitle">Mission / Vision / Values</span>
        </div>
        <div className="header-actions-group">
          <div className="brand-selector">
            <select
              value={selectedBrandId || ''}
              onChange={(e) => setSelectedBrandId(e.target.value || null)}
              className="brand-select"
            >
              {brands.map((brand) => (
                <option key={brand.id} value={brand.id}>
                  {brand.name}
                </option>
              ))}
            </select>
            <ChevronDown size={16} className="select-icon" />
          </div>
        </div>
      </header>

      {loading || leanCanvasLoading ? (
        <div className="page-loading">
          <Loader2 className="animate-spin" size={32} />
        </div>
      ) : (
        <div className="mvv-layout">
          {/* MVV ç·¨é›† */}
          <section className="mvv-edit-section">
            <MVVSection
              mvv={mvv}
              saving={saving}
              onSave={saveMVV}
              onAddValue={addValue}
              onRemoveValue={removeValue}
              onUpdateValue={updateValue}
            />
          </section>

          {/* çµ±åˆãƒ“ãƒ¥ãƒ¼ */}
          {selectedBrand && (
            <section className="mvv-unified-section">
              <h2>çµ±åˆãƒ“ãƒ¥ãƒ¼</h2>
              <UnifiedView
                brand={selectedBrand}
                leanCanvas={leanCanvas}
                mvv={mvv}
              />
            </section>
          )}
        </div>
      )}
    </div>
  );
}
```

### 6.2 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/(app)/layout.tsx` ã«è¿½åŠ 

```typescript
// import ã«è¿½åŠ 
import { Target } from 'lucide-react';

// NAV_ITEMS ã«è¿½åŠ 
{ href: '/mvv', label: 'MVV', icon: Target },
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `app/(app)/mvv/page.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã« MVV ãƒªãƒ³ã‚¯ãŒè¿½åŠ ã•ã‚ŒãŸ

---

## Step 7: CSS ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/globals.css` ã«è¿½åŠ 

```css
/*
 * MVV çµ±åˆãƒ“ãƒ¥ãƒ¼ï¼ˆPhase 19ï¼‰
 */

/* ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.mvv-page {
  padding: 24px 0;
}

.mvv-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 32px;
}

@media (max-width: 1024px) {
  .mvv-layout {
    grid-template-columns: 1fr;
  }
}

/* MVV ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.mvv-section {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.mvv-item {
  background: var(--bg-white);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}

.mvv-item-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 8px;
}

.mvv-item-icon {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  color: white;
}

.mvv-item-icon.mission {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.mvv-item-icon.vision {
  background: linear-gradient(135deg, #8b5cf6, #6d28d9);
}

.mvv-item-icon.values {
  background: linear-gradient(135deg, #ec4899, #be185d);
}

.mvv-item-label {
  flex: 1;
}

.mvv-item-label h3 {
  font-size: 16px;
  font-weight: 600;
  margin: 0;
}

.mvv-item-label .label-ja {
  font-size: 12px;
  color: var(--text-muted);
}

.mvv-item-description {
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 16px;
}

.mvv-item-content {
  padding: 16px;
  background: var(--bg-gray);
  border-radius: 8px;
}

.mvv-item-content .content-text {
  font-size: 15px;
  line-height: 1.7;
  color: var(--text-dark);
  margin: 0;
}

.mvv-item-content .content-empty {
  font-size: 14px;
  color: var(--text-muted);
  font-style: italic;
  margin: 0;
}

/* ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  */
.mvv-edit-form {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.mvv-edit-form .edit-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

/* Values ãƒªã‚¹ãƒˆ */
.values-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 16px;
}

.value-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: var(--bg-gray);
  border-radius: 8px;
}

.value-item .value-text {
  flex: 1;
  font-size: 14px;
}

.value-item .value-actions {
  display: flex;
  gap: 4px;
  opacity: 0;
  transition: opacity 0.2s;
}

.value-item:hover .value-actions {
  opacity: 1;
}

.value-item .value-edit {
  display: flex;
  gap: 8px;
  flex: 1;
}

.value-add {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.value-add .form-input {
  flex: 1;
}

.values-examples {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.values-examples .examples-label {
  font-size: 12px;
  color: var(--text-muted);
}

.values-examples .example-chip {
  font-size: 12px;
  padding: 4px 10px;
  background: var(--bg-gray);
  border: 1px solid var(--border);
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.2s;
}

.values-examples .example-chip:hover {
  background: var(--primary-alpha-10);
  border-color: var(--primary);
  color: var(--primary);
}

/* æŠ˜ã‚Šç•³ã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */
.collapsible {
  background: var(--bg-white);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 16px;
}

.collapsible-header {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  padding: 16px 20px;
  background: none;
  border: none;
  cursor: pointer;
  text-align: left;
}

.collapsible-header:hover {
  background: var(--bg-gray);
}

.collapsible-icon {
  color: var(--text-muted);
}

.collapsible-title {
  flex: 1;
}

.collapsible-title .title-text {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-dark);
}

.collapsible-title .subtitle-text {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 2px;
}

.collapsible-content {
  padding: 0 20px 20px;
}

/* çµ±åˆãƒ“ãƒ¥ãƒ¼ */
.unified-view {
  display: flex;
  flex-direction: column;
}

.unified-brand {
  padding: 16px;
}

.unified-brand .brand-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 12px;
}

.unified-brand .brand-logo {
  width: 48px;
  height: 48px;
  object-fit: contain;
  border-radius: 8px;
  background: var(--bg-gray);
}

.unified-brand .brand-info {
  flex: 1;
}

.unified-brand .brand-info h3 {
  font-size: 16px;
  font-weight: 600;
  margin: 0;
}

.unified-brand .tagline {
  font-size: 13px;
  color: var(--text-muted);
  margin: 4px 0 0;
}

.unified-brand .brand-story {
  font-size: 13px;
  color: var(--text-light);
  line-height: 1.6;
  margin: 0;
}

.unified-mvv .mvv-summary {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.unified-mvv .mvv-summary-item {
  padding: 12px;
  background: var(--bg-gray);
  border-radius: 8px;
}

.unified-mvv .mvv-summary-item .label {
  display: block;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 6px;
}

.unified-mvv .mvv-summary-item p {
  font-size: 14px;
  color: var(--text-dark);
  margin: 0;
}

.unified-mvv .values-list {
  list-style: disc;
  padding-left: 20px;
  margin: 0;
}

.unified-canvas .canvas-summary-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 12px;
}

.unified-canvas .canvas-summary-item {
  padding: 12px;
  background: var(--bg-gray);
  border-radius: 8px;
}

.unified-canvas .canvas-summary-item .label {
  display: block;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 6px;
}

.unified-canvas .canvas-summary-item ul {
  list-style: disc;
  padding-left: 16px;
  margin: 0;
  font-size: 13px;
}

.unified-canvas .canvas-summary-item .more {
  color: var(--text-muted);
  font-style: italic;
}

.unified-canvas .canvas-summary-item .empty {
  font-size: 13px;
  color: var(--text-muted);
  font-style: italic;
  margin: 0;
}

.unified-canvas .view-full-link {
  display: block;
  text-align: center;
  font-size: 13px;
  color: var(--primary);
}

.empty-message {
  text-align: center;
  padding: 24px;
  color: var(--text-muted);
}

.empty-message p {
  margin-bottom: 12px;
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] CSS ã‚¹ã‚¿ã‚¤ãƒ«ãŒè¿½åŠ ã•ã‚ŒãŸ

---

## Step 8: å‹ãƒã‚§ãƒƒã‚¯ & ãƒ“ãƒ«ãƒ‰

```bash
npm run type-check
npm run build
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] å‹ãƒã‚§ãƒƒã‚¯ãŒã‚¨ãƒ©ãƒ¼ãªãå®Œäº†
- [ ] ãƒ“ãƒ«ãƒ‰ãŒã‚¨ãƒ©ãƒ¼ãªãå®Œäº†

---

## Step 9: å‹•ä½œç¢ºèª

### 9.1 é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm run dev
```

### 9.2 ç¢ºèªé …ç›®

1. http://localhost:3000/mvv ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ä»¥ä¸‹ã‚’ç¢ºèª:
   - [ ] ãƒ–ãƒ©ãƒ³ãƒ‰é¸æŠãŒã§ãã‚‹
   - [ ] Mission ã‚’ç·¨é›†ãƒ»ä¿å­˜ã§ãã‚‹
   - [ ] Vision ã‚’ç·¨é›†ãƒ»ä¿å­˜ã§ãã‚‹
   - [ ] Values ã‚’è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã§ãã‚‹
   - [ ] çµ±åˆãƒ“ãƒ¥ãƒ¼ã«ãƒ–ãƒ©ãƒ³ãƒ‰æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] çµ±åˆãƒ“ãƒ¥ãƒ¼ã« Lean Canvas ã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] æŠ˜ã‚Šç•³ã¿ãŒå‹•ä½œã™ã‚‹

---

## Step 10: Git ãƒ—ãƒƒã‚·ãƒ¥

```bash
git add -A
git commit -m "Phase 19: MVVï¼ˆMission/Vision/Valueï¼‰çµ±åˆãƒ“ãƒ¥ãƒ¼

- supabase/migrations/20260113_phase19_mvv.sql: MVV ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- lib/types/mvv.ts: MVV å‹å®šç¾©
- app/api/mvv/route.ts: MVV å–å¾—ãƒ»ä½œæˆ API
- app/api/mvv/[mvvId]/route.ts: MVV æ›´æ–°ãƒ»å‰Šé™¤ API
- lib/hooks/useMVV.ts: MVV Hook
- components/mvv/Collapsible.tsx: æŠ˜ã‚Šç•³ã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- components/mvv/MVVSection.tsx: MVV ç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³
- components/mvv/UnifiedView.tsx: çµ±åˆãƒ“ãƒ¥ãƒ¼
- app/(app)/mvv/page.tsx: MVV ãƒšãƒ¼ã‚¸
- CSS ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"

git push
```

---

## å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### DB ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] `mvv` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] RLS ãƒãƒªã‚·ãƒ¼è¨­å®š
- [ ] ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼ˆ1ãƒ–ãƒ©ãƒ³ãƒ‰1MVVï¼‰

### å‹å®šç¾©
- [ ] MVV å‹
- [ ] MVVCreate / MVVUpdate å‹
- [ ] MVV_SECTION_INFO å®šæ•°

### API Routes
- [ ] `GET /api/mvv?brandId=xxx`
- [ ] `POST /api/mvv`
- [ ] `GET /api/mvv/:mvvId`
- [ ] `PATCH /api/mvv/:mvvId`
- [ ] `DELETE /api/mvv/:mvvId`

### React Hooks
- [ ] `useMVV` ä½œæˆ
- [ ] saveMVVï¼ˆupsertï¼‰å‹•ä½œ
- [ ] addValue / removeValue / updateValue

### UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] `Collapsible` ä½œæˆ
- [ ] `MVVSection` ä½œæˆ
- [ ] `UnifiedView` ä½œæˆ

### çµ±åˆ
- [ ] `/mvv` ãƒšãƒ¼ã‚¸ä½œæˆ
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
- [ ] å‹ãƒã‚§ãƒƒã‚¯æˆåŠŸ
- [ ] ãƒ“ãƒ«ãƒ‰æˆåŠŸ
- [ ] Git ãƒ—ãƒƒã‚·ãƒ¥å®Œäº†

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆPhase 20 ä»¥é™ï¼‰

1. **äº‹æ¥­è¨ˆç”»æ›¸ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**
   - Brand + MVV + Lean Canvas + Product Sections ã‚’ PDF å‡ºåŠ›
   - å–¶æ¥­è³‡æ–™ãƒ»æŠ•è³‡å®¶å‘ã‘ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

2. **AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆé€£æº**
   - MVV ã‹ã‚‰ Lean Canvas ææ¡ˆ
   - ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¹ãƒˆãƒ¼ãƒªãƒ¼è‡ªå‹•ç”Ÿæˆ

3. **ãƒãƒ¼ãƒ å…±æœ‰æ©Ÿèƒ½**
   - MVV ã®å…±æœ‰ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆ
   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
