# Phase 18: ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

## ç›®æ¨™

Phase 15-17 ã§ä½œæˆã—ãŸãƒ“ã‚¸ãƒã‚¹ãƒ„ãƒ¼ãƒ«ã‚’çµ±åˆã—ã€ä¸€ç›®ã§äº‹æ¥­å…¨ä½“ã‚’æŠŠæ¡ã§ãã‚‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’å®Ÿè£…ï¼š
- ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦è¡¨ç¤º
- Lean Canvas ã‚µãƒãƒªãƒ¼
- è£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ3å±¤ï¼‰ãƒ•ãƒ­ãƒ¼
- åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- é€²æ—ãƒ»å®Œæˆåº¦ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼

---

## çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã¯

```
ãƒ–ãƒ©ãƒ³ãƒ‰ã€Lean Canvasã€è£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’1ç”»é¢ã§ä¿¯ç°ã§ãã‚‹ãƒ“ãƒ¥ãƒ¼ã€‚
äº‹æ¥­è¨ˆç”»ã®å…¨ä½“åƒã‚’æŠŠæ¡ã—ã€æœªå®Œæˆç®‡æ‰€ã‚’ç‰¹å®šã§ãã‚‹ã€‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ãƒ³ãƒ‰é¸æŠ: [ãƒ–ãƒ©ãƒ³ãƒ‰å â–¼]                    å®Œæˆåº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦    â”‚  â”‚           Lean Canvas ã‚µãƒãƒªãƒ¼            â”‚ â”‚
â”‚  â”‚  ãƒ­ã‚´ãƒ»ã‚¿ã‚°ãƒ©ã‚¤ãƒ³ â”‚  â”‚  èª²é¡Œ âœ“  é¡§å®¢ âœ“  ä¾¡å€¤ â–³  è§£æ±ºç­– â—‹ ...    â”‚ â”‚
â”‚  â”‚  ã‚¹ãƒˆãƒ¼ãƒªãƒ¼       â”‚  â”‚                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    è£½å“ãƒ•ã‚¡ãƒãƒ«                               â”‚  â”‚
â”‚  â”‚  ãƒ•ãƒ­ãƒ³ãƒˆ(3) â†’ ãƒŸãƒ‰ãƒ«(2) â†’ ãƒãƒƒã‚¯(1)  äºˆæƒ³æœˆé–“åç›Š: Â¥500,000  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ                                            â”‚  â”‚
â”‚  â”‚  â–¡ Lean Canvas ã®ã€Œãƒãƒ£ãƒãƒ«ã€ã‚’è¨˜å…¥ã™ã‚‹                       â”‚  â”‚
â”‚  â”‚  â–¡ ãƒ•ãƒ­ãƒ³ãƒˆå•†å“ã‚’1ã¤è¿½åŠ ã™ã‚‹                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¿’å¾—ã™ã‚‹æ–°ã—ã„æ¦‚å¿µ

| æ¦‚å¿µ | èª¬æ˜ |
|------|------|
| çµ±åˆãƒ“ãƒ¥ãƒ¼ | è¤‡æ•°æ©Ÿèƒ½ã®ãƒ‡ãƒ¼ã‚¿ã‚’1ç”»é¢ã§è¡¨ç¤º |
| å®Œæˆåº¦è¨ˆç®— | å…¥åŠ›çŠ¶æ³ã«åŸºã¥ãé€²æ—ã®å¯è¦–åŒ– |
| åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | è£½å“ä¾¡æ ¼ã‹ã‚‰äºˆæƒ³åç›Šã‚’è¨ˆç®— |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ è‡ªå‹•ç”Ÿæˆ | æœªå®Œæˆç®‡æ‰€ã‹ã‚‰æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’ææ¡ˆ |

---

## å‰ææ¡ä»¶

- [ ] Phase 17 å®Œäº†ï¼ˆè£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‹•ä½œï¼‰
- [ ] ãƒ–ãƒ©ãƒ³ãƒ‰ã€Lean Canvasã€è£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹
- [ ] é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹

---

## Step 1: å‹å®šç¾©ã®ä½œæˆ

### 1.1 ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆå‹

**ãƒ•ã‚¡ã‚¤ãƒ«:** `lib/types/business-plan.ts`

```typescript
/**
 * lib/types/business-plan.ts
 *
 * ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å‹å®šç¾©
 */

import type { Brand } from './brand';
import type { LeanCanvas, LeanCanvasBlock } from './lean-canvas';
import type { ProductSection, Product } from './product-section';

// å®Œæˆåº¦è¨ˆç®—çµæœ
export interface CompletionStatus {
  percentage: number;
  completed: number;
  total: number;
  items: CompletionItem[];
}

export interface CompletionItem {
  category: 'brand' | 'lean-canvas' | 'products';
  field: string;
  label: string;
  completed: boolean;
  priority: 'high' | 'medium' | 'low';
}

// åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
export interface RevenueSimulation {
  monthly: number;
  annual: number;
  breakdown: {
    tier: 'front' | 'middle' | 'back';
    productCount: number;
    averagePrice: number;
    estimatedSales: number;
    subtotal: number;
  }[];
}

// çµ±åˆãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³
export interface BusinessPlanOverview {
  brand: Brand | null;
  leanCanvas: (LeanCanvas & { blocks: LeanCanvasBlock[] }) | null;
  productSection: (ProductSection & { products: Product[] }) | null;
  completion: CompletionStatus;
  revenue: RevenueSimulation | null;
  actionItems: ActionItem[];
}

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 
export interface ActionItem {
  id: string;
  type: 'brand' | 'lean-canvas' | 'products';
  title: string;
  description: string;
  priority: 'high' | 'medium' | 'low';
  link: string;
}

// å®Œæˆåº¦è¨ˆç®—ç”¨ã®è¨­å®š
export const COMPLETION_WEIGHTS = {
  brand: {
    name: { weight: 10, label: 'ãƒ–ãƒ©ãƒ³ãƒ‰å', priority: 'high' as const },
    tagline: { weight: 8, label: 'ã‚¿ã‚°ãƒ©ã‚¤ãƒ³', priority: 'medium' as const },
    story: { weight: 5, label: 'ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¹ãƒˆãƒ¼ãƒªãƒ¼', priority: 'low' as const },
    logo_url: { weight: 3, label: 'ãƒ­ã‚´', priority: 'low' as const },
  },
  leanCanvas: {
    problem: { weight: 10, label: 'èª²é¡Œ', priority: 'high' as const },
    'customer-segments': { weight: 10, label: 'é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ', priority: 'high' as const },
    'unique-value': { weight: 10, label: 'ç‹¬è‡ªã®ä¾¡å€¤ææ¡ˆ', priority: 'high' as const },
    solution: { weight: 8, label: 'è§£æ±ºç­–', priority: 'high' as const },
    channels: { weight: 6, label: 'ãƒãƒ£ãƒãƒ«', priority: 'medium' as const },
    'revenue-streams': { weight: 8, label: 'åç›Šã®æµã‚Œ', priority: 'high' as const },
    'cost-structure': { weight: 6, label: 'ã‚³ã‚¹ãƒˆæ§‹é€ ', priority: 'medium' as const },
    'key-metrics': { weight: 5, label: 'ä¸»è¦æŒ‡æ¨™', priority: 'medium' as const },
    'unfair-advantage': { weight: 4, label: 'åœ§å€’çš„ãªå„ªä½æ€§', priority: 'low' as const },
  },
  products: {
    front: { weight: 10, label: 'ãƒ•ãƒ­ãƒ³ãƒˆå•†å“', priority: 'high' as const },
    middle: { weight: 8, label: 'ãƒŸãƒ‰ãƒ«å•†å“', priority: 'medium' as const },
    back: { weight: 10, label: 'ãƒãƒƒã‚¯å•†å“', priority: 'high' as const },
  },
};

// åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
export const REVENUE_DEFAULTS = {
  front: { salesPerMonth: 20, conversionRate: 0.3 },
  middle: { salesPerMonth: 6, conversionRate: 0.5 },
  back: { salesPerMonth: 3, conversionRate: 1.0 },
};
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `lib/types/business-plan.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] CompletionStatus, RevenueSimulation å‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] COMPLETION_WEIGHTS ã«é‡ã¿ä»˜ã‘è¨­å®šãŒã‚ã‚‹

---

## Step 2: API Routes ä½œæˆ

### 2.1 ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³æ¦‚è¦ API

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/api/business-plan/[brandId]/route.ts`

```typescript
/**
 * app/api/business-plan/[brandId]/route.ts
 *
 * GET /api/business-plan/:brandId - ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆãƒ‡ãƒ¼ã‚¿å–å¾—
 */

import { NextRequest, NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';
import {
  COMPLETION_WEIGHTS,
  REVENUE_DEFAULTS,
  type CompletionStatus,
  type CompletionItem,
  type RevenueSimulation,
  type ActionItem,
} from '@/lib/types/business-plan';

// å®Œæˆåº¦è¨ˆç®—
function calculateCompletion(
  brand: Record<string, unknown> | null,
  leanCanvasBlocks: Array<{ block_type: string; content: unknown }>,
  products: Array<{ tier: string }>
): CompletionStatus {
  const items: CompletionItem[] = [];
  let totalWeight = 0;
  let completedWeight = 0;

  // ãƒ–ãƒ©ãƒ³ãƒ‰
  if (brand) {
    for (const [field, config] of Object.entries(COMPLETION_WEIGHTS.brand)) {
      const value = brand[field];
      const completed = !!value && String(value).trim() !== '';
      items.push({
        category: 'brand',
        field,
        label: config.label,
        completed,
        priority: config.priority,
      });
      totalWeight += config.weight;
      if (completed) completedWeight += config.weight;
    }
  }

  // Lean Canvas
  for (const [blockType, config] of Object.entries(COMPLETION_WEIGHTS.leanCanvas)) {
    const block = leanCanvasBlocks.find(b => b.block_type === blockType);
    const content = block?.content as { items?: string[] } | undefined;
    const completed = !!content?.items && content.items.length > 0;
    items.push({
      category: 'lean-canvas',
      field: blockType,
      label: config.label,
      completed,
      priority: config.priority,
    });
    totalWeight += config.weight;
    if (completed) completedWeight += config.weight;
  }

  // è£½å“
  for (const [tier, config] of Object.entries(COMPLETION_WEIGHTS.products)) {
    const hasProduct = products.some(p => p.tier === tier);
    items.push({
      category: 'products',
      field: tier,
      label: config.label,
      completed: hasProduct,
      priority: config.priority,
    });
    totalWeight += config.weight;
    if (hasProduct) completedWeight += config.weight;
  }

  const percentage = totalWeight > 0 ? Math.round((completedWeight / totalWeight) * 100) : 0;
  const completed = items.filter(i => i.completed).length;

  return { percentage, completed, total: items.length, items };
}

// åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
function calculateRevenue(
  products: Array<{ tier: string; price_type: string; price_min: number | null }>
): RevenueSimulation {
  const breakdown: RevenueSimulation['breakdown'] = [];

  for (const tier of ['front', 'middle', 'back'] as const) {
    const tierProducts = products.filter(p => p.tier === tier);
    const defaults = REVENUE_DEFAULTS[tier];

    const averagePrice = tierProducts.length > 0
      ? tierProducts.reduce((sum, p) => {
          if (p.price_type === 'free') return sum;
          return sum + (p.price_min || 0);
        }, 0) / tierProducts.filter(p => p.price_type !== 'free').length || 0
      : 0;

    const estimatedSales = defaults.salesPerMonth;
    const subtotal = Math.round(averagePrice * estimatedSales * defaults.conversionRate);

    breakdown.push({
      tier,
      productCount: tierProducts.length,
      averagePrice: Math.round(averagePrice),
      estimatedSales,
      subtotal,
    });
  }

  const monthly = breakdown.reduce((sum, b) => sum + b.subtotal, 0);

  return {
    monthly,
    annual: monthly * 12,
    breakdown,
  };
}

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ç”Ÿæˆ
function generateActionItems(completion: CompletionStatus): ActionItem[] {
  const items: ActionItem[] = [];

  // æœªå®Œæˆã§å„ªå…ˆåº¦ã®é«˜ã„ã‚‚ã®ã‹ã‚‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”Ÿæˆ
  const incomplete = completion.items
    .filter(i => !i.completed)
    .sort((a, b) => {
      const priorityOrder = { high: 0, medium: 1, low: 2 };
      return priorityOrder[a.priority] - priorityOrder[b.priority];
    })
    .slice(0, 5);

  for (const item of incomplete) {
    let link = '/';
    let description = '';

    switch (item.category) {
      case 'brand':
        link = '/brand';
        description = `ãƒ–ãƒ©ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸ã§ã€Œ${item.label}ã€ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†`;
        break;
      case 'lean-canvas':
        link = '/lean-canvas';
        description = `Lean Canvasã®ã€Œ${item.label}ã€ã‚’è¨˜å…¥ã—ã¾ã—ã‚‡ã†`;
        break;
      case 'products':
        link = '/product-sections';
        description = `${item.label}ã‚’è¿½åŠ ã—ã¦å•†å“ãƒ©ã‚¤ãƒ³ãƒŠãƒƒãƒ—ã‚’å®Œæˆã•ã›ã¾ã—ã‚‡ã†`;
        break;
    }

    items.push({
      id: `${item.category}-${item.field}`,
      type: item.category,
      title: `${item.label}ã‚’è¨­å®šã™ã‚‹`,
      description,
      priority: item.priority,
      link,
    });
  }

  return items;
}

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ brandId: string }> }
) {
  try {
    const { brandId } = await params;
    const supabase = await createClient();
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    if (authError || !user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // ãƒ–ãƒ©ãƒ³ãƒ‰å–å¾—
    const { data: brand } = await supabase
      .from('brands')
      .select('*')
      .eq('id', brandId)
      .eq('user_id', user.id)
      .single();

    if (!brand) {
      return NextResponse.json({ error: 'Brand not found' }, { status: 404 });
    }

    // Lean Canvas å–å¾—ï¼ˆæœ€æ–°ã®ã‚‚ã®ï¼‰
    const { data: leanCanvas } = await supabase
      .from('lean_canvas')
      .select('*')
      .eq('brand_id', brandId)
      .eq('user_id', user.id)
      .order('created_at', { ascending: false })
      .limit(1)
      .single();

    let leanCanvasBlocks: Array<{ block_type: string; content: unknown }> = [];
    if (leanCanvas) {
      const { data: blocks } = await supabase
        .from('lean_canvas_blocks')
        .select('*')
        .eq('canvas_id', leanCanvas.id);
      leanCanvasBlocks = blocks || [];
    }

    // è£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³å–å¾—ï¼ˆæœ€æ–°ã®ã‚‚ã®ï¼‰
    const { data: productSection } = await supabase
      .from('product_sections')
      .select('*')
      .eq('brand_id', brandId)
      .eq('user_id', user.id)
      .order('created_at', { ascending: false })
      .limit(1)
      .single();

    let products: Array<{ tier: string; price_type: string; price_min: number | null }> = [];
    if (productSection) {
      const { data: prods } = await supabase
        .from('products')
        .select('*')
        .eq('section_id', productSection.id);
      products = prods || [];
    }

    // å®Œæˆåº¦è¨ˆç®—
    const completion = calculateCompletion(brand, leanCanvasBlocks, products);

    // åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    const revenue = products.length > 0 ? calculateRevenue(products) : null;

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ç”Ÿæˆ
    const actionItems = generateActionItems(completion);

    return NextResponse.json({
      brand,
      leanCanvas: leanCanvas ? { ...leanCanvas, blocks: leanCanvasBlocks } : null,
      productSection: productSection ? { ...productSection, products } : null,
      completion,
      revenue,
      actionItems,
    });
  } catch (error) {
    console.error('Business plan GET error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `app/api/business-plan/[brandId]/route.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] å®Œæˆåº¦è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

---

## Step 3: React Hooks ä½œæˆ

### 3.1 ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ Hook

**ãƒ•ã‚¡ã‚¤ãƒ«:** `lib/hooks/useBusinessPlan.ts`

```typescript
/**
 * lib/hooks/useBusinessPlan.ts
 *
 * ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆãƒ‡ãƒ¼ã‚¿å–å¾— Hook
 */

import { useState, useEffect, useCallback } from 'react';
import type { BusinessPlanOverview } from '@/lib/types/business-plan';

export function useBusinessPlan(brandId: string | null) {
  const [data, setData] = useState<BusinessPlanOverview | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchData = useCallback(async () => {
    if (!brandId) {
      setData(null);
      return;
    }

    try {
      setLoading(true);
      setError(null);

      const res = await fetch(`/api/business-plan/${brandId}`);
      if (!res.ok) throw new Error('Failed to fetch business plan');

      const result = await res.json();
      setData(result);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Unknown error');
    } finally {
      setLoading(false);
    }
  }, [brandId]);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  return {
    data,
    loading,
    error,
    refetch: fetchData,
  };
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `lib/hooks/useBusinessPlan.ts` ãŒä½œæˆã•ã‚ŒãŸ

---

## Step 4: UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ

### 4.1 å®Œæˆåº¦ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/business-plan/CompletionIndicator.tsx`

```typescript
'use client';

/**
 * components/business-plan/CompletionIndicator.tsx
 *
 * å®Œæˆåº¦è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 */

import { CheckCircle, Circle, AlertCircle } from 'lucide-react';
import type { CompletionStatus } from '@/lib/types/business-plan';

interface CompletionIndicatorProps {
  completion: CompletionStatus;
  showDetails?: boolean;
}

export function CompletionIndicator({ completion, showDetails = false }: CompletionIndicatorProps) {
  const getColorClass = (percentage: number) => {
    if (percentage >= 80) return 'completion-high';
    if (percentage >= 50) return 'completion-medium';
    return 'completion-low';
  };

  return (
    <div className={`completion-indicator ${getColorClass(completion.percentage)}`}>
      <div className="completion-header">
        <span className="completion-label">å®Œæˆåº¦</span>
        <span className="completion-percentage">{completion.percentage}%</span>
      </div>

      <div className="completion-bar">
        <div
          className="completion-bar-fill"
          style={{ width: `${completion.percentage}%` }}
        />
      </div>

      <div className="completion-stats">
        <span>{completion.completed} / {completion.total} é …ç›®å®Œäº†</span>
      </div>

      {showDetails && (
        <div className="completion-details">
          {['brand', 'lean-canvas', 'products'].map(category => {
            const categoryItems = completion.items.filter(i => i.category === category);
            const categoryCompleted = categoryItems.filter(i => i.completed).length;
            const categoryLabel = {
              brand: 'ãƒ–ãƒ©ãƒ³ãƒ‰',
              'lean-canvas': 'Lean Canvas',
              products: 'è£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³',
            }[category];

            return (
              <div key={category} className="completion-category">
                <span className="category-label">{categoryLabel}</span>
                <span className="category-count">
                  {categoryCompleted}/{categoryItems.length}
                </span>
                <div className="category-items">
                  {categoryItems.map(item => (
                    <div
                      key={item.field}
                      className={`category-item ${item.completed ? 'completed' : ''}`}
                    >
                      {item.completed ? (
                        <CheckCircle size={12} />
                      ) : item.priority === 'high' ? (
                        <AlertCircle size={12} />
                      ) : (
                        <Circle size={12} />
                      )}
                      <span>{item.label}</span>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}
```

### 4.2 åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/business-plan/RevenueSimulation.tsx`

```typescript
'use client';

/**
 * components/business-plan/RevenueSimulation.tsx
 *
 * åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 */

import { TrendingUp, DollarSign } from 'lucide-react';
import type { RevenueSimulation as RevenueSimulationType } from '@/lib/types/business-plan';
import { PRODUCT_TIER_INFO } from '@/lib/types/product-section';

interface RevenueSimulationProps {
  revenue: RevenueSimulationType;
}

export function RevenueSimulation({ revenue }: RevenueSimulationProps) {
  return (
    <div className="revenue-simulation">
      <div className="revenue-header">
        <TrendingUp size={20} />
        <h3>åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
      </div>

      <div className="revenue-totals">
        <div className="revenue-total monthly">
          <span className="total-label">æœˆé–“äºˆæƒ³</span>
          <span className="total-value">Â¥{revenue.monthly.toLocaleString()}</span>
        </div>
        <div className="revenue-total annual">
          <span className="total-label">å¹´é–“äºˆæƒ³</span>
          <span className="total-value">Â¥{revenue.annual.toLocaleString()}</span>
        </div>
      </div>

      <div className="revenue-breakdown">
        <table>
          <thead>
            <tr>
              <th>å•†å“å±¤</th>
              <th>å•†å“æ•°</th>
              <th>å¹³å‡å˜ä¾¡</th>
              <th>è²©å£²æ•°/æœˆ</th>
              <th>å°è¨ˆ</th>
            </tr>
          </thead>
          <tbody>
            {revenue.breakdown.map(item => {
              const tierInfo = PRODUCT_TIER_INFO[item.tier];
              return (
                <tr key={item.tier}>
                  <td>
                    <span
                      className="tier-badge"
                      style={{ backgroundColor: tierInfo.color }}
                    >
                      {tierInfo.label}
                    </span>
                  </td>
                  <td>{item.productCount}</td>
                  <td>Â¥{item.averagePrice.toLocaleString()}</td>
                  <td>{item.estimatedSales}</td>
                  <td className="subtotal">Â¥{item.subtotal.toLocaleString()}</td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>

      <p className="revenue-note">
        * äºˆæƒ³è²©å£²æ•°ã¯ä¸€èˆ¬çš„ãªã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‡ã«åŸºã¥ãæ¦‚ç®—ã§ã™
      </p>
    </div>
  );
}
```

### 4.3 ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/business-plan/ActionItemList.tsx`

```typescript
'use client';

/**
 * components/business-plan/ActionItemList.tsx
 *
 * æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤º
 */

import Link from 'next/link';
import { ArrowRight, AlertTriangle, Info, Lightbulb } from 'lucide-react';
import type { ActionItem } from '@/lib/types/business-plan';

interface ActionItemListProps {
  items: ActionItem[];
}

export function ActionItemList({ items }: ActionItemListProps) {
  if (items.length === 0) {
    return (
      <div className="action-items-complete">
        <Lightbulb size={24} />
        <p>ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒå®Œäº†ã—ã¦ã„ã¾ã™ï¼</p>
      </div>
    );
  }

  const getPriorityIcon = (priority: ActionItem['priority']) => {
    switch (priority) {
      case 'high':
        return <AlertTriangle size={16} className="priority-high" />;
      case 'medium':
        return <Info size={16} className="priority-medium" />;
      default:
        return <Lightbulb size={16} className="priority-low" />;
    }
  };

  return (
    <div className="action-items">
      <h3>æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
      <ul className="action-list">
        {items.map(item => (
          <li key={item.id} className={`action-item priority-${item.priority}`}>
            <div className="action-icon">
              {getPriorityIcon(item.priority)}
            </div>
            <div className="action-content">
              <span className="action-title">{item.title}</span>
              <span className="action-description">{item.description}</span>
            </div>
            <Link href={item.link} className="action-link">
              <ArrowRight size={16} />
            </Link>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

### 4.4 ãƒ–ãƒ©ãƒ³ãƒ‰ã‚µãƒãƒªãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/business-plan/BrandSummary.tsx`

```typescript
'use client';

/**
 * components/business-plan/BrandSummary.tsx
 *
 * ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦è¡¨ç¤º
 */

import Link from 'next/link';
import { Palette, Edit } from 'lucide-react';
import type { Brand } from '@/lib/types/brand';

interface BrandSummaryProps {
  brand: Brand;
}

export function BrandSummary({ brand }: BrandSummaryProps) {
  return (
    <div className="brand-summary">
      <div className="summary-header">
        <Palette size={20} />
        <h3>ãƒ–ãƒ©ãƒ³ãƒ‰</h3>
        <Link href="/brand" className="edit-link">
          <Edit size={14} />
        </Link>
      </div>

      <div className="summary-content">
        {brand.logo_url && (
          <img src={brand.logo_url} alt={brand.name} className="brand-logo" />
        )}
        <div className="brand-info">
          <h4 className="brand-name">{brand.name}</h4>
          {brand.tagline && (
            <p className="brand-tagline">{brand.tagline}</p>
          )}
        </div>
      </div>

      {brand.story && (
        <p className="brand-story">{brand.story}</p>
      )}
    </div>
  );
}
```

### 4.5 Lean Canvas ã‚µãƒãƒªãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/business-plan/LeanCanvasSummary.tsx`

```typescript
'use client';

/**
 * components/business-plan/LeanCanvasSummary.tsx
 *
 * Lean Canvas æ¦‚è¦è¡¨ç¤º
 */

import Link from 'next/link';
import { LayoutGrid, Edit, CheckCircle, Circle } from 'lucide-react';
import type { LeanCanvas, LeanCanvasBlock } from '@/lib/types/lean-canvas';
import { LEAN_CANVAS_BLOCK_INFO } from '@/lib/types/lean-canvas';

interface LeanCanvasSummaryProps {
  canvas: LeanCanvas & { blocks: LeanCanvasBlock[] };
}

export function LeanCanvasSummary({ canvas }: LeanCanvasSummaryProps) {
  const blockTypes = [
    'problem',
    'customer-segments',
    'unique-value',
    'solution',
    'channels',
    'revenue-streams',
    'cost-structure',
    'key-metrics',
    'unfair-advantage',
  ];

  return (
    <div className="lean-canvas-summary">
      <div className="summary-header">
        <LayoutGrid size={20} />
        <h3>Lean Canvas</h3>
        <Link href={`/lean-canvas/${canvas.id}`} className="edit-link">
          <Edit size={14} />
        </Link>
      </div>

      <div className="canvas-blocks-grid">
        {blockTypes.map(blockType => {
          const block = canvas.blocks.find(b => b.block_type === blockType);
          const content = block?.content as { items?: string[] } | undefined;
          const hasContent = !!content?.items && content.items.length > 0;
          const info = LEAN_CANVAS_BLOCK_INFO[blockType as keyof typeof LEAN_CANVAS_BLOCK_INFO];

          return (
            <div
              key={blockType}
              className={`canvas-block-item ${hasContent ? 'completed' : ''}`}
            >
              {hasContent ? (
                <CheckCircle size={14} className="block-icon completed" />
              ) : (
                <Circle size={14} className="block-icon" />
              )}
              <span className="block-label">{info?.label || blockType}</span>
              {hasContent && (
                <span className="block-count">{content.items?.length}ä»¶</span>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}
```

### 4.6 è£½å“ãƒ•ã‚¡ãƒãƒ«ã‚µãƒãƒªãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/business-plan/ProductFunnelSummary.tsx`

```typescript
'use client';

/**
 * components/business-plan/ProductFunnelSummary.tsx
 *
 * è£½å“ãƒ•ã‚¡ãƒãƒ«æ¦‚è¦è¡¨ç¤º
 */

import Link from 'next/link';
import { Package, Edit, ArrowRight } from 'lucide-react';
import type { ProductSection, Product } from '@/lib/types/product-section';
import { PRODUCT_TIER_INFO } from '@/lib/types/product-section';

interface ProductFunnelSummaryProps {
  section: ProductSection & { products: Product[] };
}

export function ProductFunnelSummary({ section }: ProductFunnelSummaryProps) {
  const getProductsByTier = (tier: 'front' | 'middle' | 'back') =>
    section.products.filter(p => p.tier === tier);

  const frontProducts = getProductsByTier('front');
  const middleProducts = getProductsByTier('middle');
  const backProducts = getProductsByTier('back');

  return (
    <div className="product-funnel-summary">
      <div className="summary-header">
        <Package size={20} />
        <h3>è£½å“ãƒ•ã‚¡ãƒãƒ«</h3>
        <Link href={`/product-sections/${section.id}`} className="edit-link">
          <Edit size={14} />
        </Link>
      </div>

      <div className="funnel-flow">
        {(['front', 'middle', 'back'] as const).map((tier, index) => {
          const products = tier === 'front' ? frontProducts
            : tier === 'middle' ? middleProducts : backProducts;
          const info = PRODUCT_TIER_INFO[tier];
          const flagship = products.find(p => p.is_flagship) || products[0];

          return (
            <div key={tier} className="funnel-stage">
              <div
                className="stage-card"
                style={{ borderColor: info.color }}
              >
                <span
                  className="stage-badge"
                  style={{ backgroundColor: info.color }}
                >
                  {info.label}
                </span>
                <span className="stage-count">{products.length}ä»¶</span>
                {flagship && (
                  <span className="stage-flagship">{flagship.name}</span>
                )}
              </div>
              {index < 2 && (
                <ArrowRight size={16} className="funnel-arrow" />
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}
```

### 4.7 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«:** `components/business-plan/index.ts`

```typescript
export { CompletionIndicator } from './CompletionIndicator';
export { RevenueSimulation } from './RevenueSimulation';
export { ActionItemList } from './ActionItemList';
export { BrandSummary } from './BrandSummary';
export { LeanCanvasSummary } from './LeanCanvasSummary';
export { ProductFunnelSummary } from './ProductFunnelSummary';
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `components/business-plan/` ä»¥ä¸‹ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½œæˆã•ã‚ŒãŸ
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹

---

## Step 5: ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ãƒšãƒ¼ã‚¸ä½œæˆ

### 5.1 çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/(app)/business-plan/page.tsx`

```typescript
'use client';

/**
 * app/(app)/business-plan/page.tsx
 *
 * ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
 */

import { useState, useEffect } from 'react';
import { Briefcase, Loader2, ChevronDown, Plus } from 'lucide-react';
import { useBrands } from '@/lib/hooks/useBrand';
import { useBusinessPlan } from '@/lib/hooks/useBusinessPlan';
import {
  CompletionIndicator,
  RevenueSimulation,
  ActionItemList,
  BrandSummary,
  LeanCanvasSummary,
  ProductFunnelSummary,
} from '@/components/business-plan';

export default function BusinessPlanPage() {
  const { brands, isLoading: brandsLoading } = useBrands();
  const [selectedBrandId, setSelectedBrandId] = useState<string | null>(null);

  // ãƒ–ãƒ©ãƒ³ãƒ‰ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰æœ€åˆã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’é¸æŠ
  useEffect(() => {
    if (!selectedBrandId && brands.length > 0) {
      setSelectedBrandId(brands[0].id);
    }
  }, [brands, selectedBrandId]);

  const { data, loading, error } = useBusinessPlan(selectedBrandId);

  if (brandsLoading) {
    return (
      <div className="page-loading">
        <Loader2 className="animate-spin" size={32} />
        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    );
  }

  if (brands.length === 0) {
    return (
      <div className="business-plan-page">
        <header className="page-header">
          <div className="header-content">
            <Briefcase size={24} />
            <h1>ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³</h1>
          </div>
        </header>
        <div className="empty-state">
          <Briefcase size={48} />
          <h2>ãƒ–ãƒ©ãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“</h2>
          <p>ã¾ãšã€Œãƒ–ãƒ©ãƒ³ãƒ‰ã€ã‚¿ãƒ–ã§ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
        </div>
      </div>
    );
  }

  return (
    <div className="business-plan-page">
      <header className="page-header">
        <div className="header-content">
          <Briefcase size={24} />
          <h1>ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³</h1>
        </div>
        <div className="header-actions-group">
          <div className="brand-selector">
            <select
              value={selectedBrandId || ''}
              onChange={e => setSelectedBrandId(e.target.value || null)}
              className="brand-select"
            >
              {brands.map(brand => (
                <option key={brand.id} value={brand.id}>
                  {brand.name}
                </option>
              ))}
            </select>
            <ChevronDown size={16} className="select-icon" />
          </div>
        </div>
      </header>

      {loading ? (
        <div className="page-loading">
          <Loader2 className="animate-spin" size={32} />
        </div>
      ) : error ? (
        <div className="page-error">
          <p>ã‚¨ãƒ©ãƒ¼: {error}</p>
        </div>
      ) : data ? (
        <div className="business-plan-layout">
          {/* å®Œæˆåº¦ */}
          <section className="plan-section completion-section">
            <CompletionIndicator completion={data.completion} showDetails />
          </section>

          {/* ä¸Šæ®µ: ãƒ–ãƒ©ãƒ³ãƒ‰ + Lean Canvas */}
          <div className="plan-row">
            <section className="plan-section">
              {data.brand && <BrandSummary brand={data.brand} />}
            </section>
            <section className="plan-section">
              {data.leanCanvas ? (
                <LeanCanvasSummary canvas={data.leanCanvas} />
              ) : (
                <div className="empty-section">
                  <p>Lean Canvas ãŒã‚ã‚Šã¾ã›ã‚“</p>
                  <a href="/lean-canvas" className="btn btn-outline">
                    <Plus size={14} /> ä½œæˆã™ã‚‹
                  </a>
                </div>
              )}
            </section>
          </div>

          {/* ä¸­æ®µ: è£½å“ãƒ•ã‚¡ãƒãƒ« */}
          <section className="plan-section">
            {data.productSection ? (
              <ProductFunnelSummary section={data.productSection} />
            ) : (
              <div className="empty-section">
                <p>è£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“</p>
                <a href="/product-sections" className="btn btn-outline">
                  <Plus size={14} /> ä½œæˆã™ã‚‹
                </a>
              </div>
            )}
          </section>

          {/* åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ */}
          {data.revenue && data.revenue.monthly > 0 && (
            <section className="plan-section">
              <RevenueSimulation revenue={data.revenue} />
            </section>
          )}

          {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ  */}
          <section className="plan-section">
            <ActionItemList items={data.actionItems} />
          </section>
        </div>
      ) : null}
    </div>
  );
}
```

### 5.2 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/(app)/layout.tsx` ã«è¿½åŠ 

```typescript
// import ã«è¿½åŠ 
import { Briefcase } from 'lucide-react';

// NAV_ITEMS ã«è¿½åŠ ï¼ˆè£½å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œï¼‰
{ href: '/business-plan', label: 'ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³', icon: Briefcase },
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `app/(app)/business-plan/page.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªãƒ³ã‚¯ãŒè¿½åŠ ã•ã‚ŒãŸ

---

## Step 6: CSS ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«:** `app/globals.css` ã«è¿½åŠ 

```css
/*
 * ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆPhase 18ï¼‰
 */

/* ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.business-plan-page {
  padding: 24px 0;
}

.business-plan-layout {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.plan-row {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 24px;
}

@media (max-width: 900px) {
  .plan-row {
    grid-template-columns: 1fr;
  }
}

.plan-section {
  background: var(--bg-white);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}

.plan-section .summary-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border-light);
}

.plan-section .summary-header h3 {
  flex: 1;
  font-size: 16px;
  font-weight: 600;
  margin: 0;
}

.plan-section .edit-link {
  color: var(--text-muted);
  padding: 4px;
}

.plan-section .edit-link:hover {
  color: var(--primary);
}

.empty-section {
  text-align: center;
  padding: 32px;
  color: var(--text-muted);
}

.empty-section p {
  margin-bottom: 12px;
}

/* å®Œæˆåº¦ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
.completion-indicator {
  --completion-color: var(--success);
}

.completion-indicator.completion-medium {
  --completion-color: var(--warning);
}

.completion-indicator.completion-low {
  --completion-color: var(--danger);
}

.completion-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 8px;
}

.completion-label {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-dark);
}

.completion-percentage {
  font-size: 24px;
  font-weight: 700;
  color: var(--completion-color);
}

.completion-bar {
  height: 8px;
  background: var(--bg-gray);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.completion-bar-fill {
  height: 100%;
  background: var(--completion-color);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.completion-stats {
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 16px;
}

.completion-details {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.completion-category {
  padding: 12px;
  background: var(--bg-gray);
  border-radius: 8px;
}

.completion-category .category-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-dark);
}

.completion-category .category-count {
  font-size: 12px;
  color: var(--text-muted);
  margin-left: 8px;
}

.completion-category .category-items {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

.completion-category .category-item {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: var(--text-muted);
  padding: 4px 8px;
  background: var(--bg-white);
  border-radius: 4px;
}

.completion-category .category-item.completed {
  color: var(--success);
}

.completion-category .category-item svg {
  flex-shrink: 0;
}

/* ãƒ–ãƒ©ãƒ³ãƒ‰ã‚µãƒãƒªãƒ¼ */
.brand-summary .summary-content {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 12px;
}

.brand-summary .brand-logo {
  width: 60px;
  height: 60px;
  object-fit: contain;
  border-radius: 8px;
  background: var(--bg-gray);
}

.brand-summary .brand-name {
  font-size: 18px;
  font-weight: 600;
  margin: 0 0 4px 0;
}

.brand-summary .brand-tagline {
  font-size: 13px;
  color: var(--text-muted);
  margin: 0;
}

.brand-summary .brand-story {
  font-size: 13px;
  color: var(--text-light);
  line-height: 1.6;
  margin: 0;
}

/* Lean Canvas ã‚µãƒãƒªãƒ¼ */
.canvas-blocks-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}

.canvas-block-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 10px;
  background: var(--bg-gray);
  border-radius: 6px;
  font-size: 12px;
  color: var(--text-muted);
}

.canvas-block-item.completed {
  background: var(--success-alpha-10);
  color: var(--success);
}

.canvas-block-item .block-icon.completed {
  color: var(--success);
}

.canvas-block-item .block-count {
  margin-left: auto;
  font-weight: 500;
}

/* è£½å“ãƒ•ã‚¡ãƒãƒ«ã‚µãƒãƒªãƒ¼ */
.funnel-flow {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 16px 0;
}

.funnel-stage {
  display: flex;
  align-items: center;
  gap: 8px;
}

.funnel-stage .stage-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  padding: 16px 24px;
  background: var(--bg-gray);
  border-radius: 8px;
  border-top: 3px solid;
  min-width: 140px;
}

.funnel-stage .stage-badge {
  font-size: 11px;
  font-weight: 600;
  color: white;
  padding: 2px 8px;
  border-radius: 4px;
}

.funnel-stage .stage-count {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-dark);
}

.funnel-stage .stage-flagship {
  font-size: 12px;
  color: var(--text-muted);
  text-align: center;
}

.funnel-arrow {
  color: var(--text-muted);
  flex-shrink: 0;
}

/* åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ */
.revenue-simulation .revenue-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
}

.revenue-simulation .revenue-header h3 {
  font-size: 16px;
  font-weight: 600;
  margin: 0;
}

.revenue-totals {
  display: flex;
  gap: 24px;
  margin-bottom: 20px;
}

.revenue-total {
  flex: 1;
  padding: 16px;
  background: var(--bg-gray);
  border-radius: 8px;
  text-align: center;
}

.revenue-total .total-label {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 4px;
}

.revenue-total .total-value {
  font-size: 24px;
  font-weight: 700;
  color: var(--success);
}

.revenue-total.annual .total-value {
  color: var(--primary);
}

.revenue-breakdown table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.revenue-breakdown th,
.revenue-breakdown td {
  padding: 10px 12px;
  text-align: left;
  border-bottom: 1px solid var(--border-light);
}

.revenue-breakdown th {
  font-weight: 600;
  color: var(--text-muted);
  font-size: 11px;
  text-transform: uppercase;
}

.revenue-breakdown .tier-badge {
  font-size: 10px;
  font-weight: 600;
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
}

.revenue-breakdown .subtotal {
  font-weight: 600;
  color: var(--text-dark);
}

.revenue-note {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 12px;
  text-align: right;
}

/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ  */
.action-items h3 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
}

.action-items-complete {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 32px;
  color: var(--success);
}

.action-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.action-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: var(--bg-gray);
  border-radius: 8px;
  border-left: 3px solid var(--text-muted);
}

.action-item.priority-high {
  border-left-color: var(--danger);
}

.action-item.priority-medium {
  border-left-color: var(--warning);
}

.action-item.priority-low {
  border-left-color: var(--text-muted);
}

.action-item .action-icon {
  flex-shrink: 0;
}

.action-item .action-icon .priority-high {
  color: var(--danger);
}

.action-item .action-icon .priority-medium {
  color: var(--warning);
}

.action-item .action-icon .priority-low {
  color: var(--text-muted);
}

.action-item .action-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.action-item .action-title {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-dark);
}

.action-item .action-description {
  font-size: 12px;
  color: var(--text-muted);
}

.action-item .action-link {
  color: var(--primary);
  padding: 8px;
  border-radius: 6px;
}

.action-item .action-link:hover {
  background: var(--primary-alpha-10);
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] CSS ã‚¹ã‚¿ã‚¤ãƒ«ãŒè¿½åŠ ã•ã‚ŒãŸ

---

## Step 7: å‹ãƒã‚§ãƒƒã‚¯ & ãƒ“ãƒ«ãƒ‰

```bash
npm run type-check
npm run build
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] å‹ãƒã‚§ãƒƒã‚¯ãŒã‚¨ãƒ©ãƒ¼ãªãå®Œäº†
- [ ] ãƒ“ãƒ«ãƒ‰ãŒã‚¨ãƒ©ãƒ¼ãªãå®Œäº†

---

## Step 8: å‹•ä½œç¢ºèª

### 8.1 é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm run dev
```

### 8.2 ç¢ºèªé …ç›®

1. http://localhost:3000/business-plan ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ä»¥ä¸‹ã‚’ç¢ºèª:
   - [ ] ãƒ–ãƒ©ãƒ³ãƒ‰é¸æŠãŒã§ãã‚‹
   - [ ] å®Œæˆåº¦ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] Lean Canvas ã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] è£½å“ãƒ•ã‚¡ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - [ ] å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç·¨é›†ãƒªãƒ³ã‚¯ãŒæ©Ÿèƒ½ã™ã‚‹

---

## Step 9: Git ãƒ—ãƒƒã‚·ãƒ¥

```bash
git add -A
git commit -m "Phase 18: ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

- lib/types/business-plan.ts: çµ±åˆãƒ“ãƒ¥ãƒ¼å‹å®šç¾©
- app/api/business-plan/[brandId]/route.ts: çµ±åˆãƒ‡ãƒ¼ã‚¿å–å¾— API
- lib/hooks/useBusinessPlan.ts: ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ Hook
- components/business-plan/CompletionIndicator.tsx: å®Œæˆåº¦è¡¨ç¤º
- components/business-plan/RevenueSimulation.tsx: åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- components/business-plan/ActionItemList.tsx: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 
- components/business-plan/BrandSummary.tsx: ãƒ–ãƒ©ãƒ³ãƒ‰æ¦‚è¦
- components/business-plan/LeanCanvasSummary.tsx: Lean Canvas ã‚µãƒãƒªãƒ¼
- components/business-plan/ProductFunnelSummary.tsx: è£½å“ãƒ•ã‚¡ãƒãƒ«
- app/(app)/business-plan/page.tsx: çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- CSS ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"

git push
```

---

## å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å‹å®šç¾©
- [ ] CompletionStatus / CompletionItem
- [ ] RevenueSimulation
- [ ] BusinessPlanOverview
- [ ] ActionItem
- [ ] COMPLETION_WEIGHTS

### API Routes
- [ ] `GET /api/business-plan/:brandId` ä½œæˆ
- [ ] å®Œæˆåº¦è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- [ ] åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
- [ ] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ç”Ÿæˆ

### React Hooks
- [ ] `useBusinessPlan` ä½œæˆ

### UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] `CompletionIndicator` ä½œæˆ
- [ ] `RevenueSimulation` ä½œæˆ
- [ ] `ActionItemList` ä½œæˆ
- [ ] `BrandSummary` ä½œæˆ
- [ ] `LeanCanvasSummary` ä½œæˆ
- [ ] `ProductFunnelSummary` ä½œæˆ

### çµ±åˆ
- [ ] `/business-plan` ãƒšãƒ¼ã‚¸ä½œæˆ
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
- [ ] å‹ãƒã‚§ãƒƒã‚¯æˆåŠŸ
- [ ] ãƒ“ãƒ«ãƒ‰æˆåŠŸ
- [ ] Git ãƒ—ãƒƒã‚·ãƒ¥å®Œäº†

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆPhase 19 ä»¥é™ï¼‰

1. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½**
   - ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³å…¨ä½“ã‚’ PDF ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - å–¶æ¥­è³‡æ–™ãƒ»æŠ•è³‡å®¶å‘ã‘è³‡æ–™ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

2. **AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆé€£æº**
   - æœªå®Œæˆé …ç›®ã®è‡ªå‹•ææ¡ˆ
   - Lean Canvas ã‹ã‚‰ã®å•†å“ææ¡ˆ

3. **ãƒãƒ¼ãƒ å…±æœ‰æ©Ÿèƒ½**
   - ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³ã®å…±æœ‰ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆ
   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
